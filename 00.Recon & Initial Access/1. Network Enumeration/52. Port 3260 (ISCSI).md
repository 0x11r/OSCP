# iSCSI Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating iSCSI (port 3260), I realistically expect to find:

- [ ] Exposed storage targets without authentication
- [ ] Discovery of SAN target names (IQNs)
- [ ] Mountable block storage volumes
- [ ] Potential to read/write raw disks
- [ ] Leakage of internal IPs or NAT configuration

---

## ‚úÖ iSCSI Pentest Checklist

- [ ] **Port Scan & Service Detection**
  - Confirm open port and service version.
    ```
    nmap -sV -Pn -p3260 <IP>
    nmap --script iscsi-info -p3260 <IP>
    ```

- [ ] **Install iSCSI Client**
  - On Linux.
    ```
    sudo apt-get install open-iscsi
    ```

- [ ] **Discovery of Targets**
  - Identify available IQNs.
    ```
    iscsiadm -m discovery -t sendtargets -p <IP>:3260
    ```
  - Watch for internal IP leaks (NAT issues).
    ```
    192.168.1.2:3260,1 iqn.1992-05.com.vendor:target-name
    ```

- [ ] **Login to a Target**
  - Connect to a specific target.
    ```
    iscsiadm -m node --targetname="<IQN>" -p <IP>:3260 --login
    ```
  - Logout.
    ```
    iscsiadm -m node --targetname="<IQN>" -p <IP>:3260 --logout
    ```

- [ ] **Inspect Saved Node Configuration**
  - Check discovered session info and settings.
    ```
    iscsiadm -m node --targetname="<IQN>" -p <IP>:3260
    ```

- [ ] **Adjust for NAT Discrepancies**
  - If discovery reports wrong internal IP:
    1. Rename the auto-generated node folder:
        ```
        mv /etc/iscsi/nodes/<IQN>/<internalIP>,3260,1/ \
           /etc/iscsi/nodes/<IQN>/<publicIP>,3260,1/
        ```
    2. Update address inside config:
        ```
        sed -i 's/<internalIP>/<publicIP>/g' /etc/iscsi/nodes/<IQN>/<publicIP>,3260,1/default
        ```

- [ ] **Mounting Discovered Targets**
  - Linux instructions:
    - [Synology tutorial](https://www.synology.com/en-us/knowledgebase/DSM/tutorial/Virtualization/How_to_set_up_and_use_iSCSI_target_on_Linux)
  - Windows instructions:
    - [Microsoft guide](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee338476(v=ws.10))

---

## ‚úÖ Brute Forcing

- [ ] Test for weak authentication if required.
  - See related brute force guide.
    ```
    [Brute Force Tips](../../brute-force#iscsi)
    ```

---

## ‚úÖ Shodan Queries

- [ ] Search for exposed iSCSI services.
    ```
    port:3260 AuthMethod
    ```

---

## ‚úÖ References

- **Bitvijays iSCSI Guide**
    - [Pentest Scripts](https://github.com/bitvijays/Pentest-Scripts/tree/master/Vulnerability_Analysis/isciadm)
    - [Learning From the Field](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
