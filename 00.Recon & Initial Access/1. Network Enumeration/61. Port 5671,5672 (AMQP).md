# AMQP (RabbitMQ) Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating AMQP (ports 5672/5671), I realistically expect to find:

- [ ] Service banner revealing RabbitMQ version and Erlang details
- [ ] Default or weak credentials (guest/guest)
- [ ] Virtual hosts, queues, exchanges
- [ ] Broker capabilities (e.g., publisher confirms, basic.nack)
- [ ] Sensitive data in queues if access is gained
- [ ] No direct command execution, but potential message injection or pivot

---

## ‚úÖ AMQP Pentest Checklist

- [ ] **Basic Connectivity**
    - Check open ports.
    ```
    nc -v <IP> 5672
    nc -v <IP> 5671
    ```
    - Note that 5671 is typically AMQP over TLS.

---

- [ ] **Banner & Service Version with Nmap**
    - Grab version and features automatically.
    ```
    nmap -sV -Pn -n -T4 -p5672 --script amqp-info <IP>
    ```
    - Example output:
        ```
        | amqp-info: 
        |   product: RabbitMQ
        |   version: 3.1.5
        |   platform: Erlang/OTP
        |   mechanisms: PLAIN AMQPLAIN
        |   capabilities:
        |     publisher_confirms: YES
        |     consumer_cancel_notify: YES
        ```

---

- [ ] **Manual Enumeration with Python (default creds guest/guest)**
    ```python
    import amqp
    conn = amqp.connection.Connection(host="<IP>", port=5672, virtual_host="/")
    conn.connect()
    print(conn.server_properties)
    conn.close()
    ```
    - Reveals RabbitMQ version, platform, capabilities.

---

- [ ] **Check Default Credentials**
    - Default is often:
        ```
        username: guest
        password: guest
        ```
    - Try connecting with client libraries or CLI tools.

---

- [ ] **TLS Check on 5671**
    - Confirm if server expects TLS.
    ```
    openssl s_client -connect <IP>:5671
    ```
    - Useful for checking certificate details or misconfigurations.

---

- [ ] **Advanced Enumeration with RabbitMQ Tools**
    - If credentials work:
        - List vhosts
        - Enumerate queues
        - Publish / consume test messages
    - Example (using rabbitmqadmin):
        ```
        rabbitmqadmin -H <IP> -u guest -p guest list vhosts
        rabbitmqadmin -H <IP> -u guest -p guest list queues
        rabbitmqadmin -H <IP> -u guest -p guest get queue=<QUEUE>
        ```

---

## ‚úÖ Related RabbitMQ Ports to Watch For

- **1883/8883**: MQTT (no TLS / TLS)
- **15672**: HTTP Management UI (very common for credential reuse!)
- **4369**: epmd (for cluster discovery)
- **25672**: Erlang distribution (node-to-node)
- **15674/15675**: WebSockets (STOMP/MQTT)
- **61613/61614**: STOMP (no TLS / TLS)

---

## ‚úÖ Post-Exploitation Considerations

- [ ] **Management UI**
    - Default at **http://<IP>:15672**
    - Reuse AMQP creds to login
    - View queues, exchanges, users

- [ ] **Sensitive Message Data**
    - Queues may contain:
        - Password resets
        - Internal API calls
        - PII

---

## ‚úÖ Shodan Search

- [ ] Discover exposed AMQP brokers:
    ```
    AMQP port:5672
    AMQP port:5671
    ```
    - Check for public RabbitMQ servers with banner.

---

## ‚úÖ References

- [RabbitMQ Ports Overview](https://www.rabbitmq.com/networking.html)
- [AMQP Info Nmap Script](https://nmap.org/nsedoc/scripts/amqp-info.html)
- [RabbitMQ for Beginners](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
