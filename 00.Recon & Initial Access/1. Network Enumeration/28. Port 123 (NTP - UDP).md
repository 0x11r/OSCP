# ‚úÖ NTP (123/udp) Pentesting Checklist & Commands

A practical guide for assessing Network Time Protocol (NTP) services during penetration tests. Use responsibly and only with proper authorization.

---

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating NTP (default port 123/udp), I realistically expect to:

- [ ] Identify the NTP server version (for known vulnerabilities)
- [ ] Determine if `monlist` is enabled (for amplification attacks or client enumeration)
- [ ] List peers and system variables (possible internal IP or hostname leaks)


---

## ‚úÖ NTP Pentest Checklist

- [ ] **Confirm Service**
    ```bash
    nmap -sU -sV -p123 <IP>
    ```

- [ ] **Basic Enumeration with ntpq**
    ```bash
    ntpq -c readlist <IP>
    ntpq -c readvar <IP>
    ntpq -c peers <IP>
    ntpq -c associations <IP>
    ```

- [ ] **Advanced Enumeration with ntpdc**
    - Check for `monlist` (amplification vector)
    ```bash
    ntpdc -c monlist <IP>
    ntpdc -c listpeers <IP>
    ntpdc -c sysinfo <IP>
    ```

- [ ] **Nmap NSE Scripts**
    ```bash
    nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p123 <IP>
    ```

- [ ] **Check for Configuration Files (If Compromised)**
    - Example location:
      ```
      /etc/ntp.conf
      ```

- [ ] **Check for Amplification Potential**
    - Determine if server responds to `monlist`.
    ```bash
    ntpdc -n -c monlist <IP>
    ```

---

## ‚úÖ NTP Useful Commands

- **Banner Grabbing / Basic Check**
    ```bash
    nmap -sU -sV -p123 <IP>
    ```

- **ntpq Enumeration**
    ```bash
    ntpq -c readlist <IP>
    ntpq -c readvar <IP>
    ntpq -c peers <IP>
    ntpq -c associations <IP>
    ```

- **ntpdc Enumeration**
    ```bash
    ntpdc -c monlist <IP>
    ntpdc -c listpeers <IP>
    ntpdc -c sysinfo <IP>
    ```

- **Nmap NSE Scripts**
    ```bash
    nmap -sU -sV --script "ntp* and (discovery or vuln) and not (dos or brute)" -p123 <IP>
    ```

- **Shodan Search**
    ```
    ntp
    ```

---

## ‚úÖ Notes on Amplification Attacks

‚≠ê NTP uses UDP, making it susceptible to amplification-based DDoS attacks.  
‚≠ê The `monlist` command is notorious for returning large lists of past clients (up to ~600), enabling significant amplification.  
‚≠ê Example command:
```bash
ntpdc -n -c monlist <IP>
```

‚úÖ For details: [How NTP DDoS Attack Works](https://resources.infosecinstitute.com/network-time-protocol-ntp-threats-countermeasures/#gref)

---

## ‚úÖ Defensive Recommendations

- Disable or restrict the `monlist` command.
- Use `restrict` directives in ntp.conf to limit queries to trusted IPs.
- Upgrade to secure, patched versions of NTP.
- Limit NTP responses to known clients.
- Monitor logs for suspicious or volumetric traffic on port 123/udp.
