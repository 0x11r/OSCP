# MQTT (Mosquitto) Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating MQTT (port 1883), I realistically expect to find:

- [ ] Open brokers without authentication
- [ ] Clear-text credentials (if authentication is used)
- [ ] Ability to subscribe to all topics ("#") and view messages
- [ ] Sensitive device or sensor data in IoT environments
- [ ] Broker/server banner disclosing version

---

## ‚úÖ MQTT Pentest Checklist

- [ ] **Service Detection**
  - Check service version and banner.
    ```
    nmap -sV -Pn -p1883 <IP>
    ```
  - Example output:
    ```
    PORT     STATE SERVICE     VERSION
    1883/tcp open  mosquitto   1.4.8
    ```

- [ ] **Manual Connection & Subscription**
  - Connect using interactive MQTT client.
    ```
    connect
    subscribe "#" 1
    subscribe "$SYS/#"
    ```
  - Example tools:
    - [python-mqtt-client-shell](https://github.com/bapowell/python-mqtt-client-shell)
    - [mqtt-pwn](https://github.com/akamai-threat-research/mqtt-pwn)

- [ ] **Python Script for Mass Subscription**
  - Test subscribing to all topics without authentication.
    ```python
    import paho.mqtt.client as mqtt

    HOST = "127.0.0.1"
    PORT = 1883

    def on_connect(client, userdata, flags, rc):
        client.subscribe('#', qos=1)
        client.subscribe('$SYS/#')

    def on_message(client, userdata, message):
        print('Topic: %s | QOS: %s  | Message: %s' % (message.topic, message.qos, message.payload))

    client = mqtt.Client()
    client.on_connect = on_connect
    client.on_message = on_message
    client.connect(HOST, PORT)
    client.loop_forever()
    ```

---

## ‚úÖ MQTT Architecture Notes

- **Publisher**: Sends messages to topics.
- **Subscriber**: Receives messages from subscribed topics.
- **Broker**: Routes messages between publishers and subscribers.
- **Topic**: Hierarchical string (e.g., `/home/livingroom/temp`).

---

## ‚úÖ Example Topics

- `#` ‚Äì Wildcard for all topics
- `$SYS/#` ‚Äì Broker system topics

---

## ‚úÖ Vulnerability Considerations

- MQTT typically has **no encryption** by default.
- Authentication is **optional** and often missing.
- Credentials, if used, are **sent in clear text**.
- Susceptible to **MITM attacks**.

---

## ‚úÖ Shodan Dork

- `port:1883 MQTT`

---

## ‚úÖ References

- [Hacking the IoT with MQTT](https://morphuslabs.com/hacking-the-iot-with-mqtt-8edaf0d07b9b)
