# IMAP Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating IMAP (ports 143 / 993), I realistically expect to find:

- [ ] Valid login credentials (including weak or default accounts)
- [ ] NTLM information disclosure (Exchange servers)
- [ ] List of mailboxes and folders
- [ ] Full message contents (including sensitive data)
- [ ] Service banner or version info
- [ ] Possible CVEs or known weaknesses

---

## ‚úÖ IMAP Pentest Checklist

- [ ] **Banner Grabbing**
  - Identify the server version and supported features.
    ```bash
    nc -nv <IP> 143
    openssl s_client -connect <IP>:993 -quiet
    ```

- [ ] **NTLM Info Disclosure**
  - Manually trigger NTLM auth to leak version info.
    ```bash
    telnet <IP> 143
    AUTHENTICATE NTLM
    ```
  - Or automate with Nmap:
    ```bash
    nmap --script imap-ntlm-info -p143,993 <IP>
    ```

- [ ] **Check with Nmap Scan**
  - General service and version detection.
    ```bash
    nmap -sV -p143,993 --script "imap-* and not brute" <IP>
    ```
  - Credential brute-force with Nmap:
    ```bash
    nmap --script imap-brute -p143,993 <IP>
    ```

- [ ] **Brute-Force IMAP Credentials**
  - Test for weak or default passwords.
    ```bash
    hydra -l <user> -P /path/to/passwords.txt <IP> imap
    hydra -s 993 -S -l <user> -P /path/to/passwords.txt <IP> imap
    ```

---

## ‚úÖ IMAP Useful Commands

- **Basic Manual IMAP Commands**
    ```
    A1 LOGIN username password
    A1 LIST "" *
    A1 SELECT INBOX
    A1 FETCH 1:* (FLAGS)
    A1 FETCH 2 body[text]
    A1 LOGOUT
    ```

- **CURL IMAP Examples**
    - List mailboxes:
        ```bash
        curl -k 'imaps://<IP>/' --user user:pass
        ```
    - List messages:
        ```bash
        curl -k 'imaps://<IP>/INBOX?ALL' --user user:pass
        ```
    - Search for keywords:
        ```bash
        curl -k 'imaps://<IP>/Drafts?TEXT password' --user user:pass
        ```
    - Download message by index:
        ```bash
        curl -k 'imaps://<IP>/INBOX;MAILINDEX=1' --user user:pass
        ```
