# SAProuter Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating SAProuter (port 3299), I realistically expect to find:

- [ ] SAProuter service exposed to the Internet
- [ ] Misconfigured router revealing internal SAP network connections
- [ ] Internal IP ranges and target SAP system details
- [ ] Ability to proxy/scan internal hosts via SAProuter
- [ ] ACL misconfigurations allowing blind enumeration or tunneling

---

## ‚úÖ SAProuter Pentest Checklist

- [ ] **Port Scan & Service Detection**
  - Confirm open port and service version.
    ```
    nmap -sV -Pn -p3299 <IP>
    ```

- [ ] **Service Discovery**
  - Identify SAP services on the target.
    ```
    msf> use auxiliary/scanner/sap/sap_service_discovery
    msf auxiliary(sap_service_discovery) > set RHOSTS <IP>
    msf auxiliary(sap_service_discovery) > run
    ```

- [ ] **Router Info Request**
  - Retrieve internal routing tables if misconfigured.
    ```
    msf> use auxiliary/scanner/sap/sap_router_info_request
    msf auxiliary(sap_router_info_request) > set RHOSTS <IP>
    msf auxiliary(sap_router_info_request) > run
    ```
  - Look for:
    - Working directory
    - Routtab path
    - Connection tables (internal IPs and ports)

- [ ] **Port Scanning Internal Hosts via SAProuter**
  - Use the SAProuter as a pivot to scan internal services.
    ```
    msf> use auxiliary/scanner/sap/sap_router_portscanner
    msf auxiliary(sap_router_portscanner) > set RHOST <SAPROUTER_IP>
    msf auxiliary(sap_router_portscanner) > set TARGETS <INTERNAL_IP>
    msf auxiliary(sap_router_portscanner) > set PORTS 32NN
    msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
    msf auxiliary(sap_router_portscanner) > run
    ```
  - Example PORTS options for SAP services:
    ```
    32NN,33NN,48NN,80NN,36NN,81NN,...
    ```

- [ ] **Enumerate ACLs**
  - Use verbose mode to reveal ACL rules.
    ```
    msf auxiliary(sap_router_portscanner) > set VERBOSE true
    msf auxiliary(sap_router_portscanner) > run
    ```
  - Check responses for:
    - "TCP OPEN"
    - "blocked by ACL"

- [ ] **Protocol Modes**
  - Switch between SAP_PROTO and TCP modes to test ACL differences.
    ```
    msf auxiliary(sap_router_portscanner) > set MODE SAP_PROTO
    msf auxiliary(sap_router_portscanner) > set MODE TCP
    ```

- [ ] **Blind Hostname Enumeration**
  - Resolve internal hostnames via SAProuter.
    ```
    msf auxiliary(sap_router_portscanner) > set RESOLVE remote
    msf auxiliary(sap_router_portscanner) > set TARGETS sap,sapsrv,sapsrv2
    msf auxiliary(sap_router_portscanner) > set VERBOSE true
    msf auxiliary(sap_router_portscanner) > set PORTS 3200
    msf auxiliary(sap_router_portscanner) > run
    ```

- [ ] **Pivoting with Metasploit**
  - Use SAProuter as a proxy to target internal SAP services.
    ```
    msf> use auxiliary/scanner/sap/sap_hostctrl_getcomputersystem
    msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:<SAPROUTER_IP>:3299
    msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS <INTERNAL_IP>
    msf auxiliary(sap_hostctrl_getcomputersystem) > run
    ```

---

## ‚úÖ Metasploit Modules

- **Service Discovery**
    ```
    use auxiliary/scanner/sap/sap_service_discovery
    ```
- **Router Info Request**
    ```
    use auxiliary/scanner/sap/sap_router_info_request
    ```
- **Port Scanning Internal Network**
    ```
    use auxiliary/scanner/sap/sap_router_portscanner
    ```
- **Host Control Information**
    ```
    use auxiliary/scanner/sap/sap_hostctrl_getcomputersystem
    ```

---

## ‚úÖ Shodan Queries

- [ ] Search for exposed SAProuters.
    ```
    port:3299 !HTTP Network packet too big
    ```

---

## ‚úÖ References

- [Piercing SAProuter with Metasploit](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)
- [SAP Service Discovery | Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_service_discovery)
- [SAPRouter Admin Request | Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_info_request)
- [SAPRouter Port Scanner | Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_router_portscanner)
- [CVE-2013-3319 SAP Host Agent Info Disclosure | Rapid7](http://www.rapid7.com/db/modules/auxiliary/scanner/sap/sap_hostctrl_getcomputersystem)
